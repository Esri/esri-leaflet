<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="not-ie"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  
    <title>Spatial Queries on a Feature Layer | Esri Leaflet</title>
  

  
    <meta name="description" content="Create detailed spatial queries like point within polygon or line intersects polygons with Feature Layer queries. Some combinations will not result in any features being highlighted.">
  

  
    <meta http-equiv="refresh" content="0;URL='https://developers.arcgis.com/esri-leaflet/samples/spatial-queries/'" />
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv-printshiv.js"></script>
  <![endif]-->

  <!-- google fonts -->
  <link href="//fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Source+Code+Pro:300">
  <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- stylesheet -->
  <link rel="stylesheet" href="../css/style.css">

  

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

  
    <script src="https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"
      integrity="sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="
      crossorigin=""></script>
  

  
  <!-- Load Esri Leaflet Vector from CDN -->
  <script src="https://unpkg.com/esri-leaflet-vector@4.0.0/dist/esri-leaflet-vector.js"
    integrity="sha512-EMt/tpooNkBOxxQy2SOE1HgzWbg9u1gI6mT23Wl0eBWTwN9nuaPtLAaX9irNocMrHf0XhRzT8B0vXQ/bzD0I0w=="
    crossorigin=""></script>
  

  

  

  
</head>
<body>
  <div class="page-content ">
    <div class="container">
      <span id="mobileMenuButton" class="mobileMenuButton">&#9776;</span>
      <a class="site-nav" href="../" class="left logo">Esri Leaflet</a>
      <nav id="site-nav-wrapper" class="site-nav-wrapper">
        <a class="site-nav" href="../tutorials/">Tutorials</a>
        <a class="site-nav" href="../examples/">Examples</a>
        <a class="site-nav" href="../api-reference/">API Reference</a>
        <a class="site-nav" href="../plugins/">Plugins</a>
        <a class="site-nav" href="../download/">Download</a>
        <a class="site-nav" href="https://github.com/Esri/esri-leaflet">View on GitHub</a>
      </nav>
    </div>
    <div id="background-map" class="background-map"></div>
    <div class="container alertArea">This content has moved to <a href="https://developers.arcgis.com/esri-leaflet/">developers.arcgis.com</a>. Please update your bookmarks!</div>

  

<div class="container white">
  

<aside class="sidebar">
  <nav>
    <a href="../examples/">Quickstart</a>
  </nav>

  <h5>Basemaps</h5>
  <nav>
    <a href="../examples/showing-a-basemap.html">Showing an ArcGIS Basemap</a>
    <a href="../examples/basemap-with-labels.html">Basemap with Labels</a>
    <a href="../examples/composing-basemaps.html">Composing Basemaps</a>
    <a href="../examples/switching-basemaps.html">Switching Basemaps</a>
  </nav>

  <h5>Feature Layers</h5>
  <nav>
    <a href="../examples/simple-feature-layer.html">Simple FeatureLayer</a>
    <a href="../examples/styling-feature-layer-points.html">Styling Points</a>
    <a href="../examples/styling-feature-layer-polylines.html">Styling Lines</a>
    <a href="../examples/styling-feature-layer-polygons.html">Styling Polygons</a>
    <a href="../examples/feature-layer-popups.html">Custom Popups</a>
    <a href="../examples/querying-feature-layers-1.html">Querying Features #1</a>
    <a href="../examples/querying-feature-layers-2.html">Querying Features #2</a>
    <a href="../examples/spatial-queries.html">Spatial Queries</a>
    <a href="../examples/simplifying-complex-features.html">Simplifying Complex Features</a>
    <a href="../examples/zooming-to-all-features-1.html">Zoom to all Features #1</a>
    <a href="../examples/zooming-to-all-features-2.html">Zoom to all Features #2</a>
    <a href="../examples/labeling-features.html">Labeling Features</a>
    <a href="../examples/layer-ordering.html">Ordering Layers</a>
    <a href="../examples/simple-editing.html">Editing #1</a>
    <a href="../examples/editable.html">Editing #2</a>
    <a href="../examples/cedar-chart.html">Dynamic Chart (Cedar)</a>
    <a href="../examples/dynamic-chart.html">Dynamic Chart (Chart.js)</a>
  </nav>

  <h5>Feature Layer Plugins</h5>
  <nav>
    <a href="../examples/visualize-points-as-a-heatmap.html">Points as a Heatmap</a>
    <a href="../examples/styling-heatmaps.html">Styling a Heatmap</a>
    <a href="../examples/visualizing-time-with-feature-layer.html">Time Enabled Services</a>
    <a href="../examples/clustering-feature-layers.html">Clustering Points</a>
    <a href="../examples/styling-clusters.html">Styling Clusters</a>
  </nav>

  <h5>Tile Layers</h5>
  <nav>
    <a href="../examples/tile-layer-1.html">Tiles from a Map Service #1</a>
    <a href="../examples/tile-layer-2.html">Tiles from a Map Service #2</a>
  </nav>

  <h5>Dynamic Map Layer</h5>
  <nav>
    <a href="../examples/simple-dynamic-map-layer.html">Simple Dynamic Map Layer</a>
    <a href="../examples/identifying-features.html">Identifying Features</a>
    <a href="../examples/customizing-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-dynamic-map-layer.html">Time Ranges</a>
  </nav>

  <h5>Image Map Layer</h5>
  <nav>
    <a href="../examples/simple-image-map-layer.html">Simple Image Map Layer</a>
    <a href="../examples/image-map-layer-rendering-rule.html">Rendering Rule</a>
    <a href="../examples/identifying-imagery.html">Identify Imagery</a>
    <a href="../examples/image-map-layer-mosaic-rule.html">Mosaic Rule</a>
    <a href="../examples/imagery-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-image-layer.html">Time Ranges</a>
  </nav>

  <h5>Non-Mercator Projections</h5>
  <nav>
    <a href="../examples/non-mercator-projection.html">Tiles + Feature Layer</a>
    <a href="../examples/non-mercator-projection-2.html">Tiles + Dynamic Map Layer</a>
  </nav>

  <h5>Query</h5>
  <nav>
    <a href="../examples/feature-layer-snapshot.html">Layer "Snapshot"</a>
    <a href="../examples/query-no-map.html">Query without a Map</a>
  </nav>

  <h5>Authentication</h5>
  <nav>
    <a href="../examples/arcgis-online-auth.html">ArcGIS Online OAuth</a>
    <a href="../examples/premium-content.html">Premium ArcGIS Online Content</a>
    <a href="../examples/arcgis-server-auth.html">ArcGIS Server username/password</a>
  </nav>

  <h5>Geocoding</h5>
  <nav>
    <a href="../examples/geocoding-control.html">Geocoding Control</a>
    <a href="../examples/search-map-service.html">Searching Map Services</a>
    <a href="../examples/search-feature-layer.html">Searching Feature Layers</a>
    <a href="../examples/search-feature-layer-search-mode.html">Geocoding Control - searchMode</a>
    <a href="../examples/center-map-on-address.html">Center the Initial Map State</a>
    <a href="../examples/reverse-geocoding.html">Reverse Geocoding</a>
  </nav>

  <h5>Other Plugins</h5>
  <nav>
    <a href="../examples/renderers-plugin.html">Server Side Rendering</a>
    <a href="../examples/stream-plugin.html">Stream Layer</a>
    <a href="../examples/webmap.html?id=d143b33f1a02421d86b6a4ca1d7b7cd0">Loading Webmaps</a>
    <a href="../examples/gp-plugin.html">Geoprocessing</a>
  </nav>

  <h5>Misc.</h5>
  <nav>
    <a href="../examples/layers-control.html">Control.Layers</a>
    <a href="../examples/turf.html">Turf.js Mashup</a>
    <a href="../examples/getting-service-metadata.html">Getting Service Metadata</a>
    <a href="../examples/parse-feature-collection.html">Parsing Feature Collections</a>
  </nav>
</aside>


<div class="example-content">
<div class="wrap">
  <h1>Spatial Queries on a Feature Layer</h1>
  <p>Create detailed spatial queries like point within polygon or line intersects polygons with Feature Layer queries. Some combinations will not result in any features being highlighted.</p>
</div>
<div id="map-wrapper">
  <script>
    const apiKey = 'AAPKb10821df102a46a4b930958d7a6a06593sdla7i0cMWoosp7XXlYflDTAxsZMUq-oKvVOaom9B8CokPvJFd-sE88vOQ2B_rC'; // eslint-disable-line no-unused-vars, eol-last
  </script>
  

<style>
  #panel {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    background: white;
    padding: 10px;
  }
</style>

<div id="map"></div>

<div id="panel" class="leaflet-bar">
  Neighborhoods
  <select name="relation" id="relationSelect">
    <option value="within">Within<options>
    <option value="contains">Contains<options>
    <option value="intersects">Intersects<options>
    <option value="overlaps">Overlaps<options>
  </select>
  <select name="geometry" id="geometrySelect">
    <option value="bounds">Bounds<options>
    <option value="point">Point<options>
    <option value="line">Line<options>
    <option value="polygon">Polygon<options>
  </select>
  <button id="executeQuery">Run Query</button>
</div>

<script>
  var map = L.map('map').setView([45.525, -122.628], 11);

  L.esri.Vector.vectorBasemapLayer('ArcGIS:Topographic', {
    apikey: apiKey // Replace with your API key - https://developers.arcgis.com
  }).addTo(map);

  // create our layer
  var neighborhoods = L.esri.featureLayer({
    url: 'https://www.portlandmaps.com/arcgis/rest/services/Public/Zoning/MapServer/32',
    style: {
      color: '#000',
      weight: 1,
      opacity: 0.4
    }
  }).addTo(map);

  // create a marker object to query against
  var marker = L.marker([45.571034, -122.686386]).addTo(map);

  // create a bounds object to query against
  var bounds = L.latLngBounds([
    [45.494556, -122.691536],
    [45.538100, -122.608452]
  ]);

  // create a rectangle to visualize the bounds
  L.rectangle(bounds, {
    color: 'blue',
    weight: 2
  }).addTo(map);

  // create a line to query against
  var line = L.polyline([
    [45.559256, -122.611885],
    [45.502256, -122.562790],
    [45.483244, -122.620468]
  ], {
    color: 'blue',
    weight: 2
  }).addTo(map);

  // create a polygon to query against
  var polygon = L.polygon([
    [45.484894, -122.493696],
    [45.512025, -122.492199],
    [45.517669, -122.561457],
    [45.487343, -122.558573]
  ], {
    color: 'blue',
    weight: 2
  }).addTo(map);

  // collect geometries into an object so we can reference them later
  var geometries = {
    bounds: bounds,
    line: line,
    polygon: polygon,
    point: marker
  };

  // get references to our <select> elements
  var relationship = document.getElementById('relationSelect');
  var geometry = document.getElementById('geometrySelect');
  var runQueryButton = document.getElementById('executeQuery');

  var previousIds = [];

  // reset all features back to their regularly defined styles
  function reset () {
    for (var i = previousIds.length - 1; i >= 0; i--) {
      neighborhoods.resetStyle(previousIds[i]);
    }
}
  // query the API and highlight features
  function query () {
    reset();
    // lookup our input geometry
    var inputGeometry = geometries[geometry.value];

    // query the service executing the selected relation with the selected input geometry
    neighborhoods.query()[relationship.value](inputGeometry).ids(function (error, ids) {
      // if there is an error with the query, you can handle it here
      if (error) {
        console.log('Error with query: ' + error);
      } else if (ids) {
        previousIds = ids;
        for (var i = ids.length - 1; i >= 0; i--) {
          neighborhoods.setFeatureStyle(ids[i], { color: 'red', weight: 2 });
        }
      }
    });
  }

  // query when "Run Query" button is clicked
  runQueryButton.addEventListener('click', query);

  // once all neighborhoods have loaded run the default query
  neighborhoods.once('load', function () {
    query();
  });
</script>

</div>
<pre><code class="language-xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Spatial Queries on a Feature Layer<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"initial-scale=1,maximum-scale=1,user-scalable=no"</span> /&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>/&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet Vector from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet-vector@4.0.0/dist/esri-leaflet-vector.js"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-EMt/tpooNkBOxxQy2SOE1HgzWbg9u1gI6mT23Wl0eBWTwN9nuaPtLAaX9irNocMrHf0XhRzT8B0vXQ/bzD0I0w=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
    <span class="tag">body</span> <span class="rules">{ <span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
    <span class="id">#map</span> <span class="rules">{ <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>; <span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>

<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
  <span class="id">#panel</span> <span class="rules">{
    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;
    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">1000</span></span></span>;
    <span class="rule"><span class="attribute">background</span>:<span class="value"> white</span></span>;
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">10</span>px</span></span>;
  <span class="rule">}</span></span>
</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>

<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"panel"</span> <span class="attribute">class</span>=<span class="value">"leaflet-bar"</span>&gt;</span>
  Neighborhoods
  <span class="tag">&lt;<span class="title">select</span> <span class="attribute">name</span>=<span class="value">"relation"</span> <span class="attribute">id</span>=<span class="value">"relationSelect"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"within"</span>&gt;</span>Within<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"contains"</span>&gt;</span>Contains<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"intersects"</span>&gt;</span>Intersects<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"overlaps"</span>&gt;</span>Overlaps<span class="tag">&lt;<span class="title">options</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">select</span>&gt;</span>
  <span class="tag">&lt;<span class="title">select</span> <span class="attribute">name</span>=<span class="value">"geometry"</span> <span class="attribute">id</span>=<span class="value">"geometrySelect"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"bounds"</span>&gt;</span>Bounds<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"point"</span>&gt;</span>Point<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"line"</span>&gt;</span>Line<span class="tag">&lt;<span class="title">options</span>&gt;</span>
    <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">"polygon"</span>&gt;</span>Polygon<span class="tag">&lt;<span class="title">options</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">select</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">id</span>=<span class="value">"executeQuery"</span>&gt;</span>Run Query<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
  <span class="keyword">var</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">45.525</span>, -<span class="number">122.628</span>], <span class="number">11</span>);

  L.esri.Vector.vectorBasemapLayer(<span class="string">'ArcGIS:Topographic'</span>, {
    apikey: apiKey <span class="comment">// Replace with your API key - https://developers.arcgis.com</span>
  }).addTo(map);

  <span class="comment">// create our layer</span>
  <span class="keyword">var</span> neighborhoods = L.esri.featureLayer({
    url: <span class="string">'https://www.portlandmaps.com/arcgis/rest/services/Public/Zoning/MapServer/32'</span>,
    style: {
      color: <span class="string">'#000'</span>,
      weight: <span class="number">1</span>,
      opacity: <span class="number">0.4</span>
    }
  }).addTo(map);

  <span class="comment">// create a marker object to query against</span>
  <span class="keyword">var</span> marker = L.marker([<span class="number">45.571034</span>, -<span class="number">122.686386</span>]).addTo(map);

  <span class="comment">// create a bounds object to query against</span>
  <span class="keyword">var</span> bounds = L.latLngBounds([
    [<span class="number">45.494556</span>, -<span class="number">122.691536</span>],
    [<span class="number">45.538100</span>, -<span class="number">122.608452</span>]
  ]);

  <span class="comment">// create a rectangle to visualize the bounds</span>
  L.rectangle(bounds, {
    color: <span class="string">'blue'</span>,
    weight: <span class="number">2</span>
  }).addTo(map);

  <span class="comment">// create a line to query against</span>
  <span class="keyword">var</span> line = L.polyline([
    [<span class="number">45.559256</span>, -<span class="number">122.611885</span>],
    [<span class="number">45.502256</span>, -<span class="number">122.562790</span>],
    [<span class="number">45.483244</span>, -<span class="number">122.620468</span>]
  ], {
    color: <span class="string">'blue'</span>,
    weight: <span class="number">2</span>
  }).addTo(map);

  <span class="comment">// create a polygon to query against</span>
  <span class="keyword">var</span> polygon = L.polygon([
    [<span class="number">45.484894</span>, -<span class="number">122.493696</span>],
    [<span class="number">45.512025</span>, -<span class="number">122.492199</span>],
    [<span class="number">45.517669</span>, -<span class="number">122.561457</span>],
    [<span class="number">45.487343</span>, -<span class="number">122.558573</span>]
  ], {
    color: <span class="string">'blue'</span>,
    weight: <span class="number">2</span>
  }).addTo(map);

  <span class="comment">// collect geometries into an object so we can reference them later</span>
  <span class="keyword">var</span> geometries = {
    bounds: bounds,
    line: line,
    polygon: polygon,
    point: marker
  };

  <span class="comment">// get references to our &lt;select&gt; elements</span>
  <span class="keyword">var</span> relationship = document.getElementById(<span class="string">'relationSelect'</span>);
  <span class="keyword">var</span> geometry = document.getElementById(<span class="string">'geometrySelect'</span>);
  <span class="keyword">var</span> runQueryButton = document.getElementById(<span class="string">'executeQuery'</span>);

  <span class="keyword">var</span> previousIds = [];

  <span class="comment">// reset all features back to their regularly defined styles</span>
  <span class="function"><span class="keyword">function</span> <span class="title">reset</span> <span class="params">()</span> {</span>
    <span class="keyword">for</span> (<span class="keyword">var</span> i = previousIds.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {
      neighborhoods.resetStyle(previousIds[i]);
    }
}
  <span class="comment">// query the API and highlight features</span>
  <span class="function"><span class="keyword">function</span> <span class="title">query</span> <span class="params">()</span> {</span>
    reset();
    <span class="comment">// lookup our input geometry</span>
    <span class="keyword">var</span> inputGeometry = geometries[geometry.value];

    <span class="comment">// query the service executing the selected relation with the selected input geometry</span>
    neighborhoods.query()[relationship.value](inputGeometry).ids(<span class="function"><span class="keyword">function</span> <span class="params">(error, ids)</span> {</span>
      <span class="comment">// if there is an error with the query, you can handle it here</span>
      <span class="keyword">if</span> (error) {
        console.log(<span class="string">'Error with query: '</span> + error);
      } <span class="keyword">else</span> <span class="keyword">if</span> (ids) {
        previousIds = ids;
        <span class="keyword">for</span> (<span class="keyword">var</span> i = ids.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {
          neighborhoods.setFeatureStyle(ids[i], { color: <span class="string">'red'</span>, weight: <span class="number">2</span> });
        }
      }
    });
  }

  <span class="comment">// query when "Run Query" button is clicked</span>
  runQueryButton.addEventListener(<span class="string">'click'</span>, query);

  <span class="comment">// once all neighborhoods have loaded run the default query</span>
  neighborhoods.once(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    query();
  });
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>

<div class="wrap">
  <p><a href="https://github.com/Esri/esri-leaflet-doc/edit/master/src/pages/examples/spatial-queries.hbs">Edit this sample on GitHub</a></p>
</div>

<div class="mobile-menu">
  <aside class="sidebar">
  <nav>
    <a href="../examples/">Quickstart</a>
  </nav>

  <h5>Basemaps</h5>
  <nav>
    <a href="../examples/showing-a-basemap.html">Showing an ArcGIS Basemap</a>
    <a href="../examples/basemap-with-labels.html">Basemap with Labels</a>
    <a href="../examples/composing-basemaps.html">Composing Basemaps</a>
    <a href="../examples/switching-basemaps.html">Switching Basemaps</a>
  </nav>

  <h5>Feature Layers</h5>
  <nav>
    <a href="../examples/simple-feature-layer.html">Simple FeatureLayer</a>
    <a href="../examples/styling-feature-layer-points.html">Styling Points</a>
    <a href="../examples/styling-feature-layer-polylines.html">Styling Lines</a>
    <a href="../examples/styling-feature-layer-polygons.html">Styling Polygons</a>
    <a href="../examples/feature-layer-popups.html">Custom Popups</a>
    <a href="../examples/querying-feature-layers-1.html">Querying Features #1</a>
    <a href="../examples/querying-feature-layers-2.html">Querying Features #2</a>
    <a href="../examples/spatial-queries.html">Spatial Queries</a>
    <a href="../examples/simplifying-complex-features.html">Simplifying Complex Features</a>
    <a href="../examples/zooming-to-all-features-1.html">Zoom to all Features #1</a>
    <a href="../examples/zooming-to-all-features-2.html">Zoom to all Features #2</a>
    <a href="../examples/labeling-features.html">Labeling Features</a>
    <a href="../examples/layer-ordering.html">Ordering Layers</a>
    <a href="../examples/simple-editing.html">Editing #1</a>
    <a href="../examples/editable.html">Editing #2</a>
    <a href="../examples/cedar-chart.html">Dynamic Chart (Cedar)</a>
    <a href="../examples/dynamic-chart.html">Dynamic Chart (Chart.js)</a>
  </nav>

  <h5>Feature Layer Plugins</h5>
  <nav>
    <a href="../examples/visualize-points-as-a-heatmap.html">Points as a Heatmap</a>
    <a href="../examples/styling-heatmaps.html">Styling a Heatmap</a>
    <a href="../examples/visualizing-time-with-feature-layer.html">Time Enabled Services</a>
    <a href="../examples/clustering-feature-layers.html">Clustering Points</a>
    <a href="../examples/styling-clusters.html">Styling Clusters</a>
  </nav>

  <h5>Tile Layers</h5>
  <nav>
    <a href="../examples/tile-layer-1.html">Tiles from a Map Service #1</a>
    <a href="../examples/tile-layer-2.html">Tiles from a Map Service #2</a>
  </nav>

  <h5>Dynamic Map Layer</h5>
  <nav>
    <a href="../examples/simple-dynamic-map-layer.html">Simple Dynamic Map Layer</a>
    <a href="../examples/identifying-features.html">Identifying Features</a>
    <a href="../examples/customizing-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-dynamic-map-layer.html">Time Ranges</a>
  </nav>

  <h5>Image Map Layer</h5>
  <nav>
    <a href="../examples/simple-image-map-layer.html">Simple Image Map Layer</a>
    <a href="../examples/image-map-layer-rendering-rule.html">Rendering Rule</a>
    <a href="../examples/identifying-imagery.html">Identify Imagery</a>
    <a href="../examples/image-map-layer-mosaic-rule.html">Mosaic Rule</a>
    <a href="../examples/imagery-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-image-layer.html">Time Ranges</a>
  </nav>

  <h5>Non-Mercator Projections</h5>
  <nav>
    <a href="../examples/non-mercator-projection.html">Tiles + Feature Layer</a>
    <a href="../examples/non-mercator-projection-2.html">Tiles + Dynamic Map Layer</a>
  </nav>

  <h5>Query</h5>
  <nav>
    <a href="../examples/feature-layer-snapshot.html">Layer "Snapshot"</a>
    <a href="../examples/query-no-map.html">Query without a Map</a>
  </nav>

  <h5>Authentication</h5>
  <nav>
    <a href="../examples/arcgis-online-auth.html">ArcGIS Online OAuth</a>
    <a href="../examples/premium-content.html">Premium ArcGIS Online Content</a>
    <a href="../examples/arcgis-server-auth.html">ArcGIS Server username/password</a>
  </nav>

  <h5>Geocoding</h5>
  <nav>
    <a href="../examples/geocoding-control.html">Geocoding Control</a>
    <a href="../examples/search-map-service.html">Searching Map Services</a>
    <a href="../examples/search-feature-layer.html">Searching Feature Layers</a>
    <a href="../examples/search-feature-layer-search-mode.html">Geocoding Control - searchMode</a>
    <a href="../examples/center-map-on-address.html">Center the Initial Map State</a>
    <a href="../examples/reverse-geocoding.html">Reverse Geocoding</a>
  </nav>

  <h5>Other Plugins</h5>
  <nav>
    <a href="../examples/renderers-plugin.html">Server Side Rendering</a>
    <a href="../examples/stream-plugin.html">Stream Layer</a>
    <a href="../examples/webmap.html?id=d143b33f1a02421d86b6a4ca1d7b7cd0">Loading Webmaps</a>
    <a href="../examples/gp-plugin.html">Geoprocessing</a>
  </nav>

  <h5>Misc.</h5>
  <nav>
    <a href="../examples/layers-control.html">Control.Layers</a>
    <a href="../examples/turf.html">Turf.js Mashup</a>
    <a href="../examples/getting-service-metadata.html">Getting Service Metadata</a>
    <a href="../examples/parse-feature-collection.html">Parsing Feature Collections</a>
  </nav>
</aside>

</div>

</div>

  <div style="clear:both;"></div>
</div>

  <div class="container center-text">
    <p class="copyright"><a href="https://github.com/esri/esri-leaflet#terms">Terms</a></p>
  </div>
  <script src="../js/script.js"></script>
  </body>
</html>