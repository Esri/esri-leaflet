<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="not-ie"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  
    <title>Dynamic feature charting with Chart.js | Esri Leaflet</title>
  

  
    <meta name="description" content="Plot feature attributes on a dynamic chart that updates as users pan and zoom, and respond to chart interactions by modifying feature layer contents. This demo relies on &lt;a href=&quot;https://www.chartjs.org/&quot;&gt;Chart.js&lt;/a&gt; to render an interactive scatterplot.">
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv-printshiv.js"></script>
  <![endif]-->

  <!-- google fonts -->
  <link href="//fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Source+Code+Pro:300">
  <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- stylesheet -->
  <link rel="stylesheet" href="../css/style.css">

  

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

  
    <script src="https://unpkg.com/esri-leaflet@3.0.2/dist/esri-leaflet.js"
      integrity="sha512-myckXhaJsP7Q7MZva03Tfme/MSF5a6HC2xryjAM4FxPLHGqlh5VALCbywHnzs2uPoF/4G/QVXyYDDSkp5nPfig=="
      crossorigin=""></script>
  

  

  

  

  
</head>
<body>
  <div class="page-content ">
    <div class="container">
      <span id="mobileMenuButton" class="mobileMenuButton">&#9776;</span>
      <a class="site-nav" href="../" class="left logo">Esri Leaflet</a>
      <nav id="site-nav-wrapper" class="site-nav-wrapper">
        <a class="site-nav" href="../tutorials/">Tutorials</a>
        <a class="site-nav" href="../examples/">Examples</a>
        <a class="site-nav" href="../api-reference/">API Reference</a>
        <a class="site-nav" href="../plugins/">Plugins</a>
        <a class="site-nav" href="../download/">Download</a>
        <a class="site-nav" href="https://github.com/Esri/esri-leaflet">View on GitHub</a>
      </nav>
    </div>
    <div id="background-map" class="background-map"></div>

  

<div class="container white">
  

<aside class="sidebar">
  <nav>
    <a href="../examples/">Quickstart</a>
  </nav>

  <h5>Basemaps</h5>
  <nav>
    <a href="../examples/showing-a-basemap.html">Showing an ArcGIS Basemap</a>
    <a href="../examples/basemap-with-labels.html">Basemap with Labels</a>
    <a href="../examples/composing-basemaps.html">Composing Basemaps</a>
    <a href="../examples/switching-basemaps.html">Switching Basemaps</a>
    <a href="../examples/raster-basemap.html">Raster Basemaps (Classic)</a>
  </nav>

  <h5>Feature Layers</h5>
  <nav>
    <a href="../examples/simple-feature-layer.html">Simple FeatureLayer</a>
    <a href="../examples/styling-feature-layer-points.html">Styling Points</a>
    <a href="../examples/styling-feature-layer-polylines.html">Styling Lines</a>
    <a href="../examples/styling-feature-layer-polygons.html">Styling Polygons</a>
    <a href="../examples/feature-layer-popups.html">Custom Popups</a>
    <a href="../examples/querying-feature-layers-1.html">Querying Features #1</a>
    <a href="../examples/querying-feature-layers-2.html">Querying Features #2</a>
    <a href="../examples/spatial-queries.html">Spatial Queries</a>
    <a href="../examples/simplifying-complex-features.html">Simplifying Complex Features</a>
    <a href="../examples/zooming-to-all-features-1.html">Zoom to all Features #1</a>
    <a href="../examples/zooming-to-all-features-2.html">Zoom to all Features #2</a>
    <a href="../examples/labeling-features.html">Labeling Features</a>
    <a href="../examples/layer-ordering.html">Ordering Layers</a>
    <a href="../examples/simple-editing.html">Editing #1</a>
    <a href="../examples/editable.html">Editing #2</a>
    <a href="../examples/cedar-chart.html">Dynamic Chart (Cedar)</a>
    <a href="../examples/dynamic-chart.html">Dynamic Chart (Chart.js)</a>
  </nav>

  <h5>Feature Layer Plugins</h5>
  <nav>
    <a href="../examples/visualize-points-as-a-heatmap.html">Points as a Heatmap</a>
    <a href="../examples/styling-heatmaps.html">Styling a Heatmap</a>
    <a href="../examples/visualizing-time-with-feature-layer.html">Time Enabled Services</a>
    <a href="../examples/clustering-feature-layers.html">Clustering Points</a>
    <a href="../examples/styling-clusters.html">Styling Clusters</a>
  </nav>

  <h5>Tile Layers</h5>
  <nav>
    <a href="../examples/tile-layer-1.html">Tiles from a Map Service #1</a>
    <a href="../examples/tile-layer-2.html">Tiles from a Map Service #2</a>
  </nav>

  <h5>Dynamic Map Layer</h5>
  <nav>
    <a href="../examples/simple-dynamic-map-layer.html">Simple Dynamic Map Layer</a>
    <a href="../examples/identifying-features.html">Identifying Features</a>
    <a href="../examples/customizing-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-dynamic-map-layer.html">Time Ranges</a>
  </nav>

  <h5>Image Map Layer</h5>
  <nav>
    <a href="../examples/simple-image-map-layer.html">Simple Image Map Layer</a>
    <a href="../examples/image-map-layer-rendering-rule.html">Rendering Rule</a>
    <a href="../examples/identifying-imagery.html">Identify Imagery</a>
    <a href="../examples/image-map-layer-mosaic-rule.html">Mosaic Rule</a>
    <a href="../examples/imagery-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-image-layer.html">Time Ranges</a>
  </nav>

  <h5>Non-Mercator Projections</h5>
  <nav>
    <a href="../examples/non-mercator-projection.html">Tiles + Feature Layer</a>
    <a href="../examples/non-mercator-projection-2.html">Tiles + Dynamic Map Layer</a>
  </nav>

  <h5>Query</h5>
  <nav>
    <a href="../examples/feature-layer-snapshot.html">Layer "Snapshot"</a>
    <a href="../examples/query-no-map.html">Query without a Map</a>
  </nav>

  <h5>Authentication</h5>
  <nav>
    <a href="../examples/arcgis-online-auth.html">ArcGIS Online OAuth</a>
    <a href="../examples/premium-content.html">Premium ArcGIS Online Content</a>
    <a href="../examples/arcgis-server-auth.html">ArcGIS Server username/password</a>
  </nav>

  <h5>Geocoding</h5>
  <nav>
    <a href="../examples/geocoding-control.html">Geocoding Control</a>
    <a href="../examples/search-map-service.html">Searching Map Services</a>
    <a href="../examples/search-feature-layer.html">Searching Feature Layers</a>
    <a href="../examples/search-feature-layer-search-mode.html">Geocoding Control - searchMode</a>
    <a href="../examples/center-map-on-address.html">Center the Initial Map State</a>
    <a href="../examples/reverse-geocoding.html">Reverse Geocoding</a>
  </nav>

  <h5>Other Plugins</h5>
  <nav>
    <a href="../examples/renderers-plugin.html">Server Side Rendering</a>
    <a href="../examples/stream-plugin.html">Stream Layer</a>
    <a href="../examples/webmap.html?id=d143b33f1a02421d86b6a4ca1d7b7cd0">Loading Webmaps</a>
    <a href="../examples/gp-plugin.html">Geoprocessing</a>
  </nav>

  <h5>Misc.</h5>
  <nav>
    <a href="../examples/layers-control.html">Control.Layers</a>
    <a href="../examples/turf.html">Turf.js Mashup</a>
    <a href="../examples/getting-service-metadata.html">Getting Service Metadata</a>
    <a href="../examples/parse-feature-collection.html">Parsing Feature Collections</a>
  </nav>
</aside>


<div class="example-content">
<div class="wrap">
  <h1>Dynamic feature charting with Chart.js</h1>
  <p>Plot feature attributes on a dynamic chart that updates as users pan and zoom, and respond to chart interactions by modifying feature layer contents. This demo relies on <a href="https://www.chartjs.org/">Chart.js</a> to render an interactive scatterplot.</p>
</div>
<div id="map-wrapper">
  <script>
    const apiKey = 'AAPKb10821df102a46a4b930958d7a6a06593sdla7i0cMWoosp7XXlYflDTAxsZMUq-oKvVOaom9B8CokPvJFd-sE88vOQ2B_rC'; // eslint-disable-line no-unused-vars, eol-last
  </script>
  
<!-- Load Chart.js from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

<style>
  .chart-container {
    height: 245px;
    width: 245px;
  }

  #info-pane {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 400;
    padding: 1em;
    background: white;
  }
</style>

<div id="map"></div>
<div id="info-pane" class="leaflet-bar chart-container">
  <canvas id="chartCanvas"></canvas>
</div>

<script>
  // STEP 1: MAKE A MAP AND ADD LAYERS
  var map = L.map('map').setView([45.526, -122.667], 13);

  L.esri.basemapLayer('Topographic').addTo(map);

  // create and add a feature layer
  // features from this layer will appear in the Chart.js scatterplot
  var treesFeatureLayer = L.esri.featureLayer({
    url: 'https://www.portlandmaps.com/arcgis/rest/services/Public/Parks_Misc/MapServer/21/'
  });

  treesFeatureLayer.addTo(map);

  // STEP 2: DEFINE A CHART
  // this is a static scatterplot chart definition for now, but it will
  // soon become dynamic by responding to map and feature layer events
  var initialChartData = {
    datasets: [{
      label: 'Portland Heritage Trees',
      // the data values are empty at this moment
      // and will be updated dynamically below
      data: []
    }]
  };

  var chartOptions = {
    scales: {
      xAxes: [{
        scaleLabel: {
          display: true,
          labelString: 'tree diameter'
        },
        ticks: {
          beginAtZero: true,
          max: 250,
          stepSize: 50
        }
      }],
      yAxes: [{
        scaleLabel: {
          display: true,
          labelString: 'tree height'
        },
        ticks: {
          beginAtZero: true,
          max: 250,
          stepSize: 50
        }
      }]
    },
    maintainAspectRatio: false,
    // turn off animations during chart data updates
    animation: {
      duration: 0
    },
    // see STEP 4 below
    onHover: handleChartHover
  };

  var chart = new Chart('chartCanvas', {
    type: 'scatter',
    data: initialChartData,
    options: chartOptions
  });

  // STEP 3: MAKE THE CHART DYNAMIC BY ESTABLISHING MAP-TO-CHART COMMUNICATION
  // show in the scatterplot only the features in the map's current extent
  // by handling several events from both the map and feature layer
  map.on('zoom move', updateChart);
  treesFeatureLayer.on('load', updateChart);

  function updateChart () {
    // reformat the features' attributes of interest into
    // the data array format required by the Chart.js scatterplot
    var scatterPlotDataArray = [];

    treesFeatureLayer.eachActiveFeature(function (e) {
      // loop over each active feature in the map extent and
      // push an object into the scatterPlotDataArray in this format:

      // {
      //   x: diameter attribute value,
      //   y: height attribute value,
      //   featureId: unique ID for chart-to-map communication in STEP 4
      // }

      scatterPlotDataArray.push({
        x: e.feature.properties.DIAMETER,
        y: e.feature.properties.HEIGHT,
        featureId: e.feature.id
      });
    });

    // assign the new scatterPlotDataArray to the chart's data property
    chart.data.datasets[0].data = scatterPlotDataArray;

    // finally, instruct the chart to re-draw itself with the new data
    chart.update();
  }

  // STEP 4 (OPTIONAL): ESTABLISH CHART-TO-MAP COMMUNICATION
  // up until now the map and feature layer inform the chart what to render,
  // but interactions with the chart can also influence the map contents
  function handleChartHover (e) {
    var chartHoverData = chart.getElementsAtEvent(e);

    if (!chartHoverData.length) {
      // if there were no data elements found when hovering over the chart,
      // reset any previous styling overrides and return
      treesFeatureLayer.eachFeature(function (e) {
        e.setOpacity(1);
        e.setZIndexOffset(0);
      });

      return;
    }

    // otherwise, bring attention to the features on the map
    // that are currently being hovered over in the chart
    var hoverFeatureIds = chartHoverData.map(function (datum) {
      return chart.data.datasets[0].data[datum._index].featureId;
    });

    treesFeatureLayer.eachFeature(function (e, idx) {
      if (
        hoverFeatureIds.indexOf(e.feature.id) > -1
      ) {
        e.setOpacity(1);
        e.setZIndexOffset(10000);
      } else {
        e.setOpacity(0.1);
      }
    });
  }
</script>

</div>
<pre><code class="language-xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Dynamic feature charting with Chart.js<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"initial-scale=1,maximum-scale=1,user-scalable=no"</span> /&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>/&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@3.0.2/dist/esri-leaflet.js"</span>
    <span class="attribute">integrity</span>=<span class="value">"sha512-myckXhaJsP7Q7MZva03Tfme/MSF5a6HC2xryjAM4FxPLHGqlh5VALCbywHnzs2uPoF/4G/QVXyYDDSkp5nPfig=="</span>
    <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
    <span class="tag">body</span> <span class="rules">{ <span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
    <span class="id">#map</span> <span class="rules">{ <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>; <span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>

<span class="comment">&lt;!-- Load Chart.js from CDN --&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
  <span class="class">.chart-container</span> <span class="rules">{
    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">245</span>px</span></span>;
    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">245</span>px</span></span>;
  <span class="rule">}</span></span>

  <span class="id">#info-pane</span> <span class="rules">{
    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;
    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">400</span></span></span>;
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">1</span>em</span></span>;
    <span class="rule"><span class="attribute">background</span>:<span class="value"> white</span></span>;
  <span class="rule">}</span></span>
</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>

<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"info-pane"</span> <span class="attribute">class</span>=<span class="value">"leaflet-bar chart-container"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"chartCanvas"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
  <span class="comment">// STEP 1: MAKE A MAP AND ADD LAYERS</span>
  <span class="keyword">var</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">45.526</span>, -<span class="number">122.667</span>], <span class="number">13</span>);

  L.esri.basemapLayer(<span class="string">'Topographic'</span>).addTo(map);

  <span class="comment">// create and add a feature layer</span>
  <span class="comment">// features from this layer will appear in the Chart.js scatterplot</span>
  <span class="keyword">var</span> treesFeatureLayer = L.esri.featureLayer({
    url: <span class="string">'https://www.portlandmaps.com/arcgis/rest/services/Public/Parks_Misc/MapServer/21/'</span>
  });

  treesFeatureLayer.addTo(map);

  <span class="comment">// STEP 2: DEFINE A CHART</span>
  <span class="comment">// this is a static scatterplot chart definition for now, but it will</span>
  <span class="comment">// soon become dynamic by responding to map and feature layer events</span>
  <span class="keyword">var</span> initialChartData = {
    datasets: [{
      label: <span class="string">'Portland Heritage Trees'</span>,
      <span class="comment">// the data values are empty at this moment</span>
      <span class="comment">// and will be updated dynamically below</span>
      data: []
    }]
  };

  <span class="keyword">var</span> chartOptions = {
    scales: {
      xAxes: [{
        scaleLabel: {
          display: <span class="literal">true</span>,
          labelString: <span class="string">'tree diameter'</span>
        },
        ticks: {
          beginAtZero: <span class="literal">true</span>,
          max: <span class="number">250</span>,
          stepSize: <span class="number">50</span>
        }
      }],
      yAxes: [{
        scaleLabel: {
          display: <span class="literal">true</span>,
          labelString: <span class="string">'tree height'</span>
        },
        ticks: {
          beginAtZero: <span class="literal">true</span>,
          max: <span class="number">250</span>,
          stepSize: <span class="number">50</span>
        }
      }]
    },
    maintainAspectRatio: <span class="literal">false</span>,
    <span class="comment">// turn off animations during chart data updates</span>
    animation: {
      duration: <span class="number">0</span>
    },
    <span class="comment">// see STEP 4 below</span>
    onHover: handleChartHover
  };

  <span class="keyword">var</span> chart = <span class="keyword">new</span> Chart(<span class="string">'chartCanvas'</span>, {
    type: <span class="string">'scatter'</span>,
    data: initialChartData,
    options: chartOptions
  });

  <span class="comment">// STEP 3: MAKE THE CHART DYNAMIC BY ESTABLISHING MAP-TO-CHART COMMUNICATION</span>
  <span class="comment">// show in the scatterplot only the features in the map's current extent</span>
  <span class="comment">// by handling several events from both the map and feature layer</span>
  map.on(<span class="string">'zoom move'</span>, updateChart);
  treesFeatureLayer.on(<span class="string">'load'</span>, updateChart);

  <span class="function"><span class="keyword">function</span> <span class="title">updateChart</span> <span class="params">()</span> {</span>
    <span class="comment">// reformat the features' attributes of interest into</span>
    <span class="comment">// the data array format required by the Chart.js scatterplot</span>
    <span class="keyword">var</span> scatterPlotDataArray = [];

    treesFeatureLayer.eachActiveFeature(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
      <span class="comment">// loop over each active feature in the map extent and</span>
      <span class="comment">// push an object into the scatterPlotDataArray in this format:</span>

      <span class="comment">// {</span>
      <span class="comment">//   x: diameter attribute value,</span>
      <span class="comment">//   y: height attribute value,</span>
      <span class="comment">//   featureId: unique ID for chart-to-map communication in STEP 4</span>
      <span class="comment">// }</span>

      scatterPlotDataArray.push({
        x: e.feature.properties.DIAMETER,
        y: e.feature.properties.HEIGHT,
        featureId: e.feature.id
      });
    });

    <span class="comment">// assign the new scatterPlotDataArray to the chart's data property</span>
    chart.data.datasets[<span class="number">0</span>].data = scatterPlotDataArray;

    <span class="comment">// finally, instruct the chart to re-draw itself with the new data</span>
    chart.update();
  }

  <span class="comment">// STEP 4 (OPTIONAL): ESTABLISH CHART-TO-MAP COMMUNICATION</span>
  <span class="comment">// up until now the map and feature layer inform the chart what to render,</span>
  <span class="comment">// but interactions with the chart can also influence the map contents</span>
  <span class="function"><span class="keyword">function</span> <span class="title">handleChartHover</span> <span class="params">(e)</span> {</span>
    <span class="keyword">var</span> chartHoverData = chart.getElementsAtEvent(e);

    <span class="keyword">if</span> (!chartHoverData.length) {
      <span class="comment">// if there were no data elements found when hovering over the chart,</span>
      <span class="comment">// reset any previous styling overrides and return</span>
      treesFeatureLayer.eachFeature(<span class="function"><span class="keyword">function</span> <span class="params">(e)</span> {</span>
        e.setOpacity(<span class="number">1</span>);
        e.setZIndexOffset(<span class="number">0</span>);
      });

      <span class="keyword">return</span>;
    }

    <span class="comment">// otherwise, bring attention to the features on the map</span>
    <span class="comment">// that are currently being hovered over in the chart</span>
    <span class="keyword">var</span> hoverFeatureIds = chartHoverData.map(<span class="function"><span class="keyword">function</span> <span class="params">(datum)</span> {</span>
      <span class="keyword">return</span> chart.data.datasets[<span class="number">0</span>].data[datum._index].featureId;
    });

    treesFeatureLayer.eachFeature(<span class="function"><span class="keyword">function</span> <span class="params">(e, idx)</span> {</span>
      <span class="keyword">if</span> (
        hoverFeatureIds.indexOf(e.feature.id) &gt; -<span class="number">1</span>
      ) {
        e.setOpacity(<span class="number">1</span>);
        e.setZIndexOffset(<span class="number">10000</span>);
      } <span class="keyword">else</span> {
        e.setOpacity(<span class="number">0.1</span>);
      }
    });
  }
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>

<div class="wrap">
  <p><a href="https://github.com/Esri/esri-leaflet-doc/edit/master/src/pages/examples/dynamic-chart.hbs">Edit this sample on GitHub</a></p>
</div>

<div class="mobile-menu">
  <aside class="sidebar">
  <nav>
    <a href="../examples/">Quickstart</a>
  </nav>

  <h5>Basemaps</h5>
  <nav>
    <a href="../examples/showing-a-basemap.html">Showing an ArcGIS Basemap</a>
    <a href="../examples/basemap-with-labels.html">Basemap with Labels</a>
    <a href="../examples/composing-basemaps.html">Composing Basemaps</a>
    <a href="../examples/switching-basemaps.html">Switching Basemaps</a>
    <a href="../examples/raster-basemap.html">Raster Basemaps (Classic)</a>
  </nav>

  <h5>Feature Layers</h5>
  <nav>
    <a href="../examples/simple-feature-layer.html">Simple FeatureLayer</a>
    <a href="../examples/styling-feature-layer-points.html">Styling Points</a>
    <a href="../examples/styling-feature-layer-polylines.html">Styling Lines</a>
    <a href="../examples/styling-feature-layer-polygons.html">Styling Polygons</a>
    <a href="../examples/feature-layer-popups.html">Custom Popups</a>
    <a href="../examples/querying-feature-layers-1.html">Querying Features #1</a>
    <a href="../examples/querying-feature-layers-2.html">Querying Features #2</a>
    <a href="../examples/spatial-queries.html">Spatial Queries</a>
    <a href="../examples/simplifying-complex-features.html">Simplifying Complex Features</a>
    <a href="../examples/zooming-to-all-features-1.html">Zoom to all Features #1</a>
    <a href="../examples/zooming-to-all-features-2.html">Zoom to all Features #2</a>
    <a href="../examples/labeling-features.html">Labeling Features</a>
    <a href="../examples/layer-ordering.html">Ordering Layers</a>
    <a href="../examples/simple-editing.html">Editing #1</a>
    <a href="../examples/editable.html">Editing #2</a>
    <a href="../examples/cedar-chart.html">Dynamic Chart (Cedar)</a>
    <a href="../examples/dynamic-chart.html">Dynamic Chart (Chart.js)</a>
  </nav>

  <h5>Feature Layer Plugins</h5>
  <nav>
    <a href="../examples/visualize-points-as-a-heatmap.html">Points as a Heatmap</a>
    <a href="../examples/styling-heatmaps.html">Styling a Heatmap</a>
    <a href="../examples/visualizing-time-with-feature-layer.html">Time Enabled Services</a>
    <a href="../examples/clustering-feature-layers.html">Clustering Points</a>
    <a href="../examples/styling-clusters.html">Styling Clusters</a>
  </nav>

  <h5>Tile Layers</h5>
  <nav>
    <a href="../examples/tile-layer-1.html">Tiles from a Map Service #1</a>
    <a href="../examples/tile-layer-2.html">Tiles from a Map Service #2</a>
  </nav>

  <h5>Dynamic Map Layer</h5>
  <nav>
    <a href="../examples/simple-dynamic-map-layer.html">Simple Dynamic Map Layer</a>
    <a href="../examples/identifying-features.html">Identifying Features</a>
    <a href="../examples/customizing-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-dynamic-map-layer.html">Time Ranges</a>
  </nav>

  <h5>Image Map Layer</h5>
  <nav>
    <a href="../examples/simple-image-map-layer.html">Simple Image Map Layer</a>
    <a href="../examples/image-map-layer-rendering-rule.html">Rendering Rule</a>
    <a href="../examples/identifying-imagery.html">Identify Imagery</a>
    <a href="../examples/image-map-layer-mosaic-rule.html">Mosaic Rule</a>
    <a href="../examples/imagery-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-image-layer.html">Time Ranges</a>
  </nav>

  <h5>Non-Mercator Projections</h5>
  <nav>
    <a href="../examples/non-mercator-projection.html">Tiles + Feature Layer</a>
    <a href="../examples/non-mercator-projection-2.html">Tiles + Dynamic Map Layer</a>
  </nav>

  <h5>Query</h5>
  <nav>
    <a href="../examples/feature-layer-snapshot.html">Layer "Snapshot"</a>
    <a href="../examples/query-no-map.html">Query without a Map</a>
  </nav>

  <h5>Authentication</h5>
  <nav>
    <a href="../examples/arcgis-online-auth.html">ArcGIS Online OAuth</a>
    <a href="../examples/premium-content.html">Premium ArcGIS Online Content</a>
    <a href="../examples/arcgis-server-auth.html">ArcGIS Server username/password</a>
  </nav>

  <h5>Geocoding</h5>
  <nav>
    <a href="../examples/geocoding-control.html">Geocoding Control</a>
    <a href="../examples/search-map-service.html">Searching Map Services</a>
    <a href="../examples/search-feature-layer.html">Searching Feature Layers</a>
    <a href="../examples/search-feature-layer-search-mode.html">Geocoding Control - searchMode</a>
    <a href="../examples/center-map-on-address.html">Center the Initial Map State</a>
    <a href="../examples/reverse-geocoding.html">Reverse Geocoding</a>
  </nav>

  <h5>Other Plugins</h5>
  <nav>
    <a href="../examples/renderers-plugin.html">Server Side Rendering</a>
    <a href="../examples/stream-plugin.html">Stream Layer</a>
    <a href="../examples/webmap.html?id=d143b33f1a02421d86b6a4ca1d7b7cd0">Loading Webmaps</a>
    <a href="../examples/gp-plugin.html">Geoprocessing</a>
  </nav>

  <h5>Misc.</h5>
  <nav>
    <a href="../examples/layers-control.html">Control.Layers</a>
    <a href="../examples/turf.html">Turf.js Mashup</a>
    <a href="../examples/getting-service-metadata.html">Getting Service Metadata</a>
    <a href="../examples/parse-feature-collection.html">Parsing Feature Collections</a>
  </nav>
</aside>

</div>

</div>

  <div style="clear:both;"></div>
</div>

  <div class="container center-text">
    <p class="copyright"><a href="https://github.com/esri/esri-leaflet#terms">Terms</a></p>
  </div>
  <script src="../js/script.js"></script>
  </body>
</html>