<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="not-ie"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  
    <title>Use Turf and Esri Leaflet together | Esri Leaflet</title>
  

  
    <meta name="description" content="Esri Leaflet pairs nicely with clientside libraries that can perform spatial analysis in the browser like &lt;a href=&quot;http://turfjs.org/getting-started/&quot;&gt;Turf.js&lt;/a&gt;. This demo shows how the output from a spatial query can be augmented to isolate features that have a spatial relationship with another arbitrary geometry.">
  

  <meta name="description" content="Esri Leaflet">
  <meta name="viewport" content="width=device-width">

  <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv-printshiv.js"></script>
  <![endif]-->

  <!-- google fonts -->
  <link href='//fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Source+Code+Pro:300">
  <link href='//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

  <!-- stylesheet -->
  <link rel="stylesheet" href="../css/style.css">

  

  
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/esri-leaflet@2.0.8"></script>
  

  

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44963317-3', 'auto');
    ga('send', 'pageview');
  </script>
  <!-- End Google Analytics -->
</head>
<body>
  <div class="page-content ">
    <div class="container">
      <a class="site-nav" href="../" class="left logo">Esri Leaflet</a>
      <nav class="right">
        <a class="site-nav" href="../tutorials/">Tutorials</a>
        <a class="site-nav" href="../plugins/">Plugins</a>
        <a class="site-nav" href="../examples/">Examples</a>
        <a class="site-nav" href="../api-reference/">API Reference</a>
        <a class="site-nav" href="../download/">Download</a>
        <a class="site-nav" href="https://github.com/Esri/esri-leaflet">View on GitHub</a>
      </nav>
    </div>
    <div id="background-map" class="background-map"></div>

  

<div class="container white">
  

<aside class="sidebar">
  <h5>Basemaps</h5>
  <nav>
    <a href="../examples/showing-a-basemap.html">Showing an ArcGIS Basemap</a>
    <a href="../examples/basemap-with-labels.html">Basemap with Labels</a>
    <a href="../examples/switching-basemaps.html">Switching Basemaps</a>
    <a href="../examples/retina-basemap.html">Retina Basemap</a>
    <a href="../examples/vector-basemap.html">Vector Basemaps</a>
  </nav>

  <h5>Feature Layers</h5>
  <nav>
    <a href="../examples/simple-feature-layer.html">Simple FeatureLayer</a>
    <a href="../examples/styling-feature-layer-points.html">Styling Points</a>
    <a href="../examples/styling-feature-layer-polylines.html">Styling Lines</a>
    <a href="../examples/styling-feature-layer-polygons.html">Styling Polygons</a>
    <a href="../examples/feature-layer-popups.html">Custom Popups</a>
    <a href="../examples/querying-feature-layers-1.html">Querying Features #1</a>
    <a href="../examples/querying-feature-layers-2.html">Querying Features #2</a>
    <a href="../examples/spatial-queries.html">Spatial Queries</a>
    <a href="../examples/simplifying-complex-features.html">Simplifying Complex Features</a>
    <a href="../examples/zooming-to-all-features-1.html">Zoom to all Features #1</a>
    <a href="../examples/zooming-to-all-features-2.html">Zoom to all Features #2</a>
    <a href="../examples/labeling-features.html">Labeling Features</a>
    <a href="../examples/layer-ordering.html">Ordering Layers</a>
    <a href="../examples/editing.html">Editing</a>
  </nav>

  <h5>Feature Layer Plugins</h5>
  <nav>
    <a href="../examples/visualize-points-as-a-heatmap.html">Points as a Heatmap</a>
    <a href="../examples/styling-heatmaps.html">Styling a heatmap</a>
    <a href="../examples/visualizing-time-with-feature-layer.html">Time Enabled Services</a>
    <a href="../examples/clustering-feature-layers.html">Clustering Points</a>
    <a href="../examples/styling-clusters.html">Styling Clusters</a>
  </nav>

  <h5>Tile Layers</h5>
  <nav>
    <a href="../examples/tile-layer-1.html">Tiles from a Map Service #1</a>
    <a href="../examples/tile-layer-2.html">Tiles from a Map Service #2</a>
  </nav>

  <h5>Dynamic Map Layer</h5>
  <nav>
    <a href="../examples/simple-dynamic-map-layer.html">Simple Dynamic Map Layer</a>
    <a href="../examples/identifying-features.html">Identifying Features</a>
    <a href="../examples/customizing-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-dynamic-map-layer.html">Time Ranges</a>
  </nav>

  <h5>Image Map Layer</h5>
  <nav>
    <a href="../examples/simple-image-map-layer.html">Simple Image Map Layer</a>
    <a href="../examples/image-map-layer-rendering-rule.html">Rendering Rule</a>
    <a href="../examples/identifying-imagery.html">Identify Imagery</a>
    <a href="../examples/image-map-layer-mosaic-rule.html">Mosaic Rule</a>
    <a href="../examples/imagery-popups.html">Custom Popups</a>
    <a href="../examples/visualizing-time-on-image-layer.html">Time Ranges</a>
  </nav>

  <h5>Non-Mercator Projections</h5>
  <nav>
    <a href="../examples/non-mercator-projection.html">Tiles + Feature Layer</a>
    <a href="../examples/non-mercator-projection-2.html">Tiles + Dynamic Map Layer</a>
  </nav>

  <h5>Query</h5>
  <nav>
    <a href="../examples/feature-layer-snapshot.html">Layer "Snapshot"</a>
    <a href="../examples/query-no-map.html">Query without a Map</a>
  </nav>

  <h5>Authentication</h5>
  <nav>
    <a href="../examples/arcgis-online-auth.html">ArcGIS Online OAuth</a>
    <a href="../examples/premium-content.html">Premium ArcGIS Online Content</a>
    <a href="../examples/arcgis-server-auth.html">ArcGIS Server username/password</a>
  </nav>

  <h5>Geocoding</h5>
  <nav>
    <a href="../examples/geocoding-control.html">Geocoding Control</a>
    <a href="../examples/search-map-service.html">Searching Map Services</a>
    <a href="../examples/search-feature-layer.html">Searching Feature Layers</a>
    <a href="../examples/center-map-on-address.html">Center the Initial Map State</a>
    <a href="../examples/reverse-geocoding.html">Reverse Geocoding</a>
  </nav>

  <h5>Other Plugins</h5>
  <nav>
    <a href="../examples/renderers-plugin.html">Server Side Rendering</a>
    <a href="../examples/stream-plugin.html">Stream Layer</a>
    <a href="../examples/webmap.html?id=22c504d229f14c789c5b49ebff38b941">Loading Webmaps</a>
    <a href="../examples/gp-plugin.html">Geoprocessing</a>
  </nav>

  <h5>Misc.</h5>
  <nav>
    <a href="../examples/layers-control.html">Control.Layers</a>
    <a href="../examples/turf.html">Turf.js Mashup</a>
    <a href="../examples/getting-service-metadata.html">Getting Service Metadata</a>
    <a href="../examples/parse-feature-collection.html">Parsing Feature Collections</a>
  </nav>
</aside>


<div class="example-content">
<div class="wrap">
  <h1>Use Turf and Esri Leaflet together</h1>
  <p>Esri Leaflet pairs nicely with clientside libraries that can perform spatial analysis in the browser like <a href="http://turfjs.org/getting-started/">Turf.js</a>. This demo shows how the output from a spatial query can be augmented to isolate features that have a spatial relationship with another arbitrary geometry.</p>
</div>
<div id="map-wrapper">
  

<script src="https://unpkg.com/@turf/turf@3.5.1/turf.min.js"></script>

<style>
  #info-pane {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1000;
    padding: 1em;
    background: white;
    max-width: 150px;
  }
</style>

<div id="map"></div>
<div id="info-pane" class="leaflet-bar">
  <label>
  Census block points that intersect both bounding boxes and are shown in red.
  </label>
</div>

<script type='text/javascript'>
  // two GeoJSON bounding boxes.  the first smaller than the second.
    var boundingBoxes = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": {
            "color": "orange"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [ -84.39010620117188, 33.747965492070236 ],
                [ -84.39010620117188, 33.75431694675655 ],
                [ -84.37311172485352, 33.75431694675655 ],
                [ -84.37311172485352, 33.747965492070236 ],
                [ -84.39010620117188, 33.747965492070236 ]
              ]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "color": "#0ceb70"
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [ -84.39963340759277, 33.744254312044156 ],
                [ -84.39963340759277,  33.75817040902938 ],
                [ -84.38444137573242, 33.75817040902938 ],
                [ -84.38444137573242, 33.744254312044156 ],
                [ -84.39963340759277, 33.744254312044156 ]
              ]
            ]
          }
        }
      ]
    }

    // draw a map of atlanta
    var map = L.map('map').setView([33.752, -84.385], 14.5);
    L.esri.basemapLayer('Topographic').addTo(map);

    // display the bounding boxes on the map
    L.geoJSON(boundingBoxes, {
      style: function (feature) {
        return {color: feature.properties.color};
      }
    }).addTo(map);

    // query for census block points that intersect the smaller box
    var query = L.esri.query({
      url: 'http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/0'
    })
    query.intersects(boundingBoxes.features[0])
    query.run(function (err, censusCollection, raw) {
      var features = censusCollection.features;
      // loop through the collection of census block points
      for (i=0; i<features.length; i++) {
        // if the point is inside (or contained by, the bigger box) draw it in red
        if (turf.inside(features[i], boundingBoxes.features[1])) {
          L.geoJSON(features[i], {
            pointToLayer: function(geoJsonPoint, latlng) {
              return L.circleMarker(latlng, {
                color: '#ff0066'
              });
            }
          }).addTo(map);
        } else {
          // if its outside (or not contained) by the bigger box, make it less opaque.
          L.geoJSON(features[i], {
            pointToLayer: function(geoJsonPoint, latlng) {
              return L.circleMarker(latlng, {
                radius: 10,
                color: 'gray',
                opacity: 0.2
              });
            }
          }).addTo(map);
        }
      }
    });
</script>

</div>
<pre><code class="language-xml"><span class="tag">&lt;<span class="title">html</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">utf-8</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Use Turf and Esri Leaflet together<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">'viewport'</span> <span class="attribute">content</span>=<span class="value">'initial-scale=1,maximum-scale=1,user-scalable=no'</span> /&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN--&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.0.3/dist/leaflet.css"</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@2.0.8"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
    <span class="tag">body</span> <span class="rules">{ <span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
    <span class="id">#map</span> <span class="rules">{ <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>; <span class="rule"><span class="attribute">top</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">bottom</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">right</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">0</span></span></span>; <span class="rule">}</span></span>
  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/@turf/turf@3.5.1/turf.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
  <span class="id">#info-pane</span> <span class="rules">{
    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;
    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">10</span>px</span></span>;
    <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">1000</span></span></span>;
    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">1</span>em</span></span>;
    <span class="rule"><span class="attribute">background</span>:<span class="value"> white</span></span>;
    <span class="rule"><span class="attribute">max-width</span>:<span class="value"> <span class="number">150</span>px</span></span>;
  <span class="rule">}</span></span>
</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>

<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"info-pane"</span> <span class="attribute">class</span>=<span class="value">"leaflet-bar"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">label</span>&gt;</span>
  Census block points that intersect both bounding boxes and are shown in red.
  <span class="tag">&lt;/<span class="title">label</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">'text/javascript'</span>&gt;</span><span class="javascript">
  <span class="comment">// two GeoJSON bounding boxes.  the first smaller than the second.</span>
    <span class="keyword">var</span> boundingBoxes = {
      <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,
      <span class="string">"features"</span>: [
        {
          <span class="string">"type"</span>: <span class="string">"Feature"</span>,
          <span class="string">"properties"</span>: {
            <span class="string">"color"</span>: <span class="string">"orange"</span>
          },
          <span class="string">"geometry"</span>: {
            <span class="string">"type"</span>: <span class="string">"Polygon"</span>,
            <span class="string">"coordinates"</span>: [
              [
                [ -<span class="number">84.39010620117188</span>, <span class="number">33.747965492070236</span> ],
                [ -<span class="number">84.39010620117188</span>, <span class="number">33.75431694675655</span> ],
                [ -<span class="number">84.37311172485352</span>, <span class="number">33.75431694675655</span> ],
                [ -<span class="number">84.37311172485352</span>, <span class="number">33.747965492070236</span> ],
                [ -<span class="number">84.39010620117188</span>, <span class="number">33.747965492070236</span> ]
              ]
            ]
          }
        },
        {
          <span class="string">"type"</span>: <span class="string">"Feature"</span>,
          <span class="string">"properties"</span>: {
            <span class="string">"color"</span>: <span class="string">"#0ceb70"</span>
          },
          <span class="string">"geometry"</span>: {
            <span class="string">"type"</span>: <span class="string">"Polygon"</span>,
            <span class="string">"coordinates"</span>: [
              [
                [ -<span class="number">84.39963340759277</span>, <span class="number">33.744254312044156</span> ],
                [ -<span class="number">84.39963340759277</span>,  <span class="number">33.75817040902938</span> ],
                [ -<span class="number">84.38444137573242</span>, <span class="number">33.75817040902938</span> ],
                [ -<span class="number">84.38444137573242</span>, <span class="number">33.744254312044156</span> ],
                [ -<span class="number">84.39963340759277</span>, <span class="number">33.744254312044156</span> ]
              ]
            ]
          }
        }
      ]
    }

    <span class="comment">// draw a map of atlanta</span>
    <span class="keyword">var</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">33.752</span>, -<span class="number">84.385</span>], <span class="number">14.5</span>);
    L.esri.basemapLayer(<span class="string">'Topographic'</span>).addTo(map);

    <span class="comment">// display the bounding boxes on the map</span>
    L.geoJSON(boundingBoxes, {
      style: <span class="function"><span class="keyword">function</span> <span class="params">(feature)</span> {</span>
        <span class="keyword">return</span> {color: feature.properties.color};
      }
    }).addTo(map);

    <span class="comment">// query for census block points that intersect the smaller box</span>
    <span class="keyword">var</span> query = L.esri.query({
      url: <span class="string">'http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer/0'</span>
    })
    query.intersects(boundingBoxes.features[<span class="number">0</span>])
    query.run(<span class="function"><span class="keyword">function</span> <span class="params">(err, censusCollection, raw)</span> {</span>
      <span class="keyword">var</span> features = censusCollection.features;
      <span class="comment">// loop through the collection of census block points</span>
      <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;features.length; i++) {
        <span class="comment">// if the point is inside (or contained by, the bigger box) draw it in red</span>
        <span class="keyword">if</span> (turf.inside(features[i], boundingBoxes.features[<span class="number">1</span>])) {
          L.geoJSON(features[i], {
            pointToLayer: <span class="function"><span class="keyword">function</span><span class="params">(geoJsonPoint, latlng)</span> {</span>
              <span class="keyword">return</span> L.circleMarker(latlng, {
                color: <span class="string">'#ff0066'</span>
              });
            }
          }).addTo(map);
        } <span class="keyword">else</span> {
          <span class="comment">// if its outside (or not contained) by the bigger box, make it less opaque.</span>
          L.geoJSON(features[i], {
            pointToLayer: <span class="function"><span class="keyword">function</span><span class="params">(geoJsonPoint, latlng)</span> {</span>
              <span class="keyword">return</span> L.circleMarker(latlng, {
                radius: <span class="number">10</span>,
                color: <span class="string">'gray'</span>,
                opacity: <span class="number">0.2</span>
              });
            }
          }).addTo(map);
        }
      }
    });
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>

<div class="wrap">
  <p><a href="http://github.com/Esri/esri-leaflet-doc/edit/master/src/pages/examples/turf.hbs">Edit this sample on GitHub</a></p>
</div>
</div>

  <div style='clear:both;'></div>
</div>
<div class="container centered-text">
  <p class="copyright">Esri Leaflet is a project from the <a href="http://pdx.esri.com">Esri PDX R&amp;D Center</a> and the <a href="https://github.com/Esri/esri-leaflet/graphs/contributors">Esri Community</a></p>
</div>

  </div>
  <script src="../js/script.js"></script>
  </body>
</html>