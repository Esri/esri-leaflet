/*! Esri-Leaflet - v0.0.1 - 2013-06-14
*   Copyright (c) 2013 Environmental Systems Research Institute, Inc.
*   Apache License*/
(function(e,t){"function"==typeof define&&define.amd&&define(t),"object"==typeof window&&(e.Esri=t())})(this,function(){function e(e){var t=[];for(var r in e)if(e.hasOwnProperty(r))if(Array.isArray(e[r]))for(var n=0,o=e[r].length;o>n;n++)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r][n]));else t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")}function t(e,t,r,n){function o(e,t){t&&(a.token=t),n(e,t)}var i="https://www.arcgis.com/sharing/generateToken";this.options&&this.options.authenticationUrl&&(i=this.options.authenticationUrl);var s={username:e,password:t,f:"json",referer:"arcgis-node"};r&&r.expiration&&(s.expiration=r.expiration);var a=this;this.requestHandler.post(i,s,o)}function r(e,t){this.lastQuery=null,this.url=null,this.options=e,this.callback=t,this.requestHandler={get:a,post:u},this.get()}function n(e,t,r){r&&(t&&t.error?r(t.error,null):r(e,t))}function o(e){var t="http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer";return e&&e.geocoderUrl&&(t=e.geocoderUrl),t}function i(t,r){t.f=t.f||"json";var n=o(this.options);n+="/find?",n+=e(t),this.requestHandler.get(n,r)}function s(e){this.data=[],this.token=e}function a(e,t){function r(){if(this.readyState===this.DONE&&200===this.status)try{var e=JSON.parse(this.responseText);t(null,e)}catch(r){t("Invalid JSON on response")}}var n=new XMLHttpRequest;n.onreadystatechange=r,n.open("GET",e),void 0!==n.setDisableHeaderCheck&&(n.setDisableHeaderCheck(!0),n.setRequestHeader("Referer","geoservices-js")),n.send(null)}function u(t,r,n){function o(){if(this.readyState===this.DONE&&200===this.status)try{var e=JSON.parse(this.responseText);n(null,e)}catch(t){n("Invalid JSON on response")}}var i=new XMLHttpRequest;i.onreadystatechange=o,i.open("POST",t),void 0!==i.setDisableHeaderCheck&&(i.setDisableHeaderCheck(!0),i.setRequestHeader("Referer","geoservices-js")),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e(r))}function c(e){this.options=e,this.geocode=i,this.FeatureService=r,this.authenticate=t,this.requestHandler={get:a,post:u};var n=this;this.geocode.Batch=function(e){e=e||n.token;var t=new i.Batch(e);return t.requestHandler=request,t}}var l={};return r.prototype.buildUrl=function(){var e,t=this.options;return e=t.url?t.url:[t.catalog,t.service,t.type].join("/")+(t.layer?"/"+t.layer:"")},r.prototype.get=function(){var e=this.options,t=this.callback;return!e||e.catalog||e.service||e.type||e.url?(this.url=this.buildUrl(),this.token=e.token,this.issueRequest(null,{f:e.format||"json"},t),void 0):(this.callback&&t('Must provide at least a feature service "catalog", "service" and "type", or a "url" to a feature service or feature layer'),void 0)},r.prototype.issueRequest=function(t,r,o,i){r.f=r.f||"json",r.outFields=r.outFields||"*",(r.token||this.token)&&(r.token=r.token||this.token);var s="";t&&(s="/"+t);var a=this.url+s;i&&"get"!==i.toLowerCase()?this.requestHandler.post(a,r,function(e,t){n(e,t,o)}):(a=a+"?"+e(r),this.requestHandler.get(a,function(e,t){n(e,t,o)}))},r.prototype.query=function(e,t){this.lastQuery=e;var r=e.method||"get";delete e.method,this.issueRequest("query",e,t,r)},r.prototype.count=function(e,t){e.returnCountOnly=!0,e.returnIdsOnly=!1,this.query(e,t)},r.prototype.ids=function(e,t){e.returnIdsOnly=!0,e.returnCountOnly=!1,this.query(e,t)},r.prototype.update=function(e,t){this.issueRequest("updateFeatures",e,t,"post")},r.prototype.add=function(e,t){this.issueRequest("addFeatures",e,t,"post")},r.prototype.remove=function(e,t){this.issueRequest("deleteFeatures",e,t,"post")},r.prototype.edit=function(e,t){issueRequest("applyEdits",e,t,"post")},s.prototype.geocode=function(e,t){t||(t=this.data.length+1),"object"==typeof e?e.OBJECTID=t:"string"==typeof e&&(e={SingleLine:e,OBJECTID:t}),this.data.push({attributes:e})},s.prototype.setToken=function(e){this.token=e},s.prototype.run=function(e){var t=new Date;if(!this.token||!this.token.token||t>this.token.expires)e("Valid authentication token is required");else{var r=JSON.stringify({records:this.data}),n={token:this.token.token,addresses:r,f:"json",referer:"arcgis-node"},i=o(this.options);i+="/geocodeAddresses",this.requestHandler.post(i,n,e)}},l.ArcGIS=c,l}),function(e,t){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=t()),"function"==typeof define&&define.amd&&define(t),"object"==typeof window&&(e.Terraformer=t())}(this,function(){function e(){this._thens=[]}function t(){var e=Array.prototype.slice.apply(arguments);void 0!==typeof console&&console.warn&&console.warn.apply(console,e)}function r(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function n(e){switch(e.type){case"Point":return[e.coordinates[0],e.coordinates[1],e.coordinates[0],e.coordinates[1]];case"MultiPoint":return s(e.coordinates);case"LineString":return s(e.coordinates);case"MultiLineString":return o(e.coordinates);case"Polygon":return o(e.coordinates);case"MultiPolygon":return i(e.coordinates);case"Feature":return n(e.geometry);case"FeatureCollection":return a(e);case"GeometryCollection":return u(e);default:throw Error("Unknown type: "+e.type)}}function o(e){for(var t=null,r=null,n=null,o=null,i=0;e.length>i;i++)for(var s=e[i],a=0;s.length>a;a++){var u=s[a],c=u[0],l=u[1];null===t?t=c:t>c&&(t=c),null===r?r=c:c>r&&(r=c),null===n?n=l:n>l&&(n=l),null===o?o=l:l>o&&(o=l)}return[t,n,r,o]}function i(e){for(var t=null,r=null,n=null,o=null,i=0;e.length>i;i++)for(var s=e[i],a=0;s.length>a;a++)for(var u=s[a],c=0;u.length>c;c++){var l=u[c],h=l[0],p=l[1];null===t?t=h:t>h&&(t=h),null===r?r=h:h>r&&(r=h),null===n?n=p:n>p&&(n=p),null===o?o=p:p>o&&(o=p)}return[t,n,r,o]}function s(e){for(var t=null,r=null,n=null,o=null,i=0;e.length>i;i++){var s=e[i],a=s[0],u=s[1];null===t?t=a:t>a&&(t=a),null===r?r=a:a>r&&(r=a),null===n?n=u:n>u&&(n=u),null===o?o=u:u>o&&(o=u)}return[t,n,r,o]}function a(e){for(var t,r=[],o=e.features.length-1;o>=0;o--)t=n(e.features[o].geometry),r.push([t[0],t[1]]),r.push([t[2],t[3]]);return s(r)}function u(e){for(var t,r=[],o=e.geometries.length-1;o>=0;o--)t=n(e.geometries[o]),r.push([t[0],t[1]]),r.push([t[2],t[3]]);return s(r)}function c(e){var t=n(e);return{x:t[0],y:t[1],w:Math.abs(t[0]-t[2]),h:Math.abs(t[1]-t[3])}}function l(e){return e*V}function h(e){return e*X}function p(e,t){for(var r=0;e.length>r;r++)"number"==typeof e[r][0]&&(e[r]=t(e[r])),"object"==typeof e[r]&&(e[r]=p(e[r],t));return e}function f(e){var t=e[0],r=e[1];return[l(t/W)-360*Math.floor((l(t/W)+180)/360),l(Math.PI/2-2*Math.atan(Math.exp(-1*r/W)))]}function d(e){var t=e[0],r=Math.max(Math.min(e[1],89.99999),-89.99999);return[h(t)*W,W/2*Math.log((1+Math.sin(h(r)))/(1-Math.sin(h(r))))]}function y(e,t,r){if("Point"===e.type)e.coordinates=t(e.coordinates);else if("Feature"===e.type)e.geometry=y(e.geometry,t,!0);else if("FeatureCollection"===e.type)for(var n=0;e.features.length>n;n++)e.features[n]=y(e.features[n],t,!0);else if("GeometryCollection"===e.type)for(var o=0;e.geometries.length>o;o++)e.geometries[o]=y(e.geometries[o],t,!0);else e.coordinates=p(e.coordinates,t);return r||t===d&&(e.crs=Q),t===f&&delete e.crs,e}function g(e){return y(e,d)}function m(e){return y(e,f)}function v(e,t){return t>e?-1:e>t?1:0}function x(e,t,r){return v((t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1]),0)}function b(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function w(e,t){var r=t;for(var n in e){var o=x(t,r,e[n]);(-1===o||0===o&&b(t,e[n])>b(t,r))&&(r=e[n])}return r}function _(e){function t(e,t){return e[0]-t[0]>e[1]-t[1]?1:e[0]-t[0]<e[1]-t[1]?-1:0}if(0===e.length)return[];if(1===e.length)return e;for(var r=[e.sort(t)[0]],n=0;r.length>n;n++){var o=w(e,r[n]);o!==r[0]&&r.push(o)}return r}function M(e,t){for(var r=!1,n=-1,o=e.length,i=o-1;o>++n;i=n)(e[n][1]<=t[1]&&t[1]<e[i][1]||e[i][1]<=t[1]&&t[1]<e[n][1])&&t[0]<(e[i][0]-e[n][0])*(t[1]-e[n][1])/(e[i][1]-e[n][1])+e[n][0]&&(r=!0);return r}function L(e,t){if(e&&e.length){if(1===e.length)return M(e[0],t);if(M(e[0],t)){for(var r=1;e.length>r;r++)if(M(e[r],t))return!1;return!0}return!1}return!1}function T(e,t,r,n){var o=(n[0]-r[0])*(e[1]-r[1])-(n[1]-r[1])*(e[0]-r[0]),i=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]),s=(n[1]-r[1])*(t[0]-e[0])-(n[0]-r[0])*(t[1]-e[1]);if(0!==s){var a=o/s,u=i/s;if(a>=0&&1>=a&&u>=0&&1>=u)return!0}return!1}function S(e,t){for(var r=0;e.length-1>r;r++)for(var n=0;t.length-1>n;n++)if(T(e[r],e[r+1],t[n],t[n+1]))return!0;return!1}function P(e,t){for(var r=0;t.length>r;r++)for(var n=t[r],o=0;n.length-1>o;o++)for(var i=0;e.length-1>i;i++)if(T(n[o],n[o+1],e[i],e[i+1]))return!0;return!1}function R(e,t){for(var r=0;e.length>r;r++)if(P(e[r],t))return!0;return!1}function G(e,t){for(var r=0;t.length>r;r++)return P(e,t[r])?!0:!1}function A(e,t){for(var r=0;e.length>r;r++)return G(e[r],t)?!0:!1}function k(e,t){for(var r=0;e.length>r;r++)return A(e[r],t)?!0:!1}function E(e){for(var t=[],r=0;e.length>r;r++){var n=e[r].slice();j(n[0],n[n.length-1])===!1&&n.push(n[0]),t.push(n)}return t}function j(e,t){for(var r=0;e.length>r;r++)for(var n=0;t.length>n;n++)if(e[r]!==t[n])return!1;return!0}function C(e){if(e)switch(e.type){case"Point":return new O(e);case"MultiPoint":return new q(e);case"LineString":return new I(e);case"MultiLineString":return new U(e);case"Polygon":return new B(e);case"MultiPolygon":return new F(e);case"Feature":return new N(e);case"FeatureCollection":return new z(e);case"GeometryCollection":return new D(e);default:throw Error("Unknown type: "+e.type)}}function O(e){var t=Array.prototype.slice.call(arguments);if(e&&"Point"===e.type&&e.coordinates)r(this,e);else if(e&&Array.isArray(e))this.coordinates=e;else{if(!(t.length>=2))throw"Terraformer: invalid input for Terraformer.Point";this.coordinates=t}this.type="Point",this.__defineGetter__("bbox",function(){return n(this)})}function q(e){if(e&&"MultiPoint"===e.type&&e.coordinates)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.MultiPoint";this.coordinates=e}this.type="MultiPoint",this.__defineGetter__("bbox",function(){return n(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function I(e){if(e&&"LineString"===e.type&&e.coordinates)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.LineString";this.coordinates=e}this.type="LineString",this.__defineGetter__("bbox",function(){return n(this)})}function U(e){if(e&&"MultiLineString"===e.type&&e.coordinates)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.MultiLineString";this.coordinates=e}this.type="MultiLineString",this.__defineGetter__("bbox",function(){return n(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function B(e){if(e&&"Polygon"===e.type&&e.coordinates)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.Polygon";this.coordinates=e}this.type="Polygon",this.__defineGetter__("bbox",function(){return n(this)})}function F(e){if(e&&"MultiPolygon"===e.type&&e.coordinates)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.MultiPolygon";this.coordinates=e}this.type="MultiPolygon",this.__defineGetter__("bbox",function(){return n(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function N(e){if(e&&"Feature"===e.type&&e.geometry)r(this,e);else{if(!(e&&e.type&&e.coordinates))throw"Terraformer: invalid input for Terraformer.Feature";this.geometry=e}this.type="Feature",this.__defineGetter__("bbox",function(){return n(this)})}function z(e){if(e&&"FeatureCollection"===e.type&&e.features)r(this,e);else{if(!Array.isArray(e))throw"Terraformer: invalid input for Terraformer.FeatureCollection";this.features=e}this.type="FeatureCollection",this.__defineGetter__("length",function(){return this.features?this.features.length:0}),this.__defineGetter__("bbox",function(){return n(this)})}function D(e){if(e&&"GeometryCollection"===e.type&&e.geometries)r(this,e);else if(Array.isArray(e))this.geometries=e;else{if(!e.coordinates||!e.type)throw"Terraformer: invalid input for Terraformer.GeometryCollection";this.type="GeometryCollection",this.geometries=[e]}this.type="GeometryCollection",this.__defineGetter__("length",function(){return this.geometries?this.geometries.length:0}),this.__defineGetter__("bbox",function(){return n(this)})}function H(e,t,r){for(var n=d(e),o=r||64,i=t||250,s={type:"Polygon",coordinates:[[]]},a=1;o>=a;a++){var u=a*(360/o)*Math.PI/180;s.coordinates[0].push([n[0]+i*Math.cos(u),n[1]+i*Math.sin(u)])}return m(s)}function Z(e,t,o){var i=o||64,s=t||250;if(!e||2>e.length||!s||!i)throw Error("Terraformer: missing parameter for Terraformer.Circle");r(this,new N({type:"Feature",geometry:H(e,s,i),properties:{radius:s,center:e,steps:i}})),this.__defineGetter__("bbox",function(){return n(this)}),this.__defineGetter__("radius",function(){return this.properties.radius}),this.__defineSetter__("radius",function(e){this.properties.radius=e,this.recalculate()}),this.__defineGetter__("steps",function(){return this.properties.steps}),this.__defineSetter__("steps",function(e){this.properties.steps=e,this.recalculate()}),this.__defineGetter__("center",function(){return this.properties.center}),this.__defineSetter__("center",function(e){this.properties.center=e,this.recalculate()})}var J={},W=6378137,V=57.29577951308232,X=.017453292519943,Q={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}},K={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}};e.prototype={then:function(e,t){return this._thens.push({resolve:e,reject:t}),this},resolve:function(e){return this._complete("resolve",e),this},reject:function(e){return this._complete("reject",e),this},_complete:function(e,t){this.then="resolve"===e?function(e){e(t)}:function(e,r){r(t)},this.resolve=this.reject=function(){throw Error("Deferred already completed.")};for(var r=0;this._thens.length>r;r++){var n=this._thens[r];n[e]&&n[e](t)}delete this._thens}};var Y=["length","bbox"];return C.prototype={toMercator:function(){return g(this)},toGeographic:function(){return m(this)},envelope:function(){var e=n(this);return{x:e[0],y:e[1],w:Math.abs(e[0]-e[2]),h:Math.abs(e[1]-e[3])}},convexHull:function(){var e,t,r=[];if("Point"===this.type)return this.coordinates&&this.coordinates.length>0?[this.coordinates]:[];if("LineString"===this.type||"MultiPoint"===this.type){if(!(this.coordinates&&this.coordinates.length>0))return[];r=this.coordinates}else if("Polygon"===this.type||"MultiLineString"===this.type){if(!(this.coordinates&&this.coordinates.length>0))return[];for(e=0;this.coordinates.length>e;e++)r=r.concat(this.coordinates[e])}else{if("MultiPolygon"!==this.type)throw Error("Unable to get convex hull of "+this.type);if(!(this.coordinates&&this.coordinates.length>0))return[];for(e=0;this.coordinates.length>e;e++)for(t=0;this.coordinates[e].length>t;t++)r=r.concat(this.coordinates[e][t])}return _(r)},toJSON:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&this[t]&&Y.indexOf(t)&&(e[t]=this[t]);return e.bbox=n(this),e},toJson:function(){return JSON.stringify(this)}},C.prototype.intersects=function(e){if("Feature"===e.type&&(e=e.geometry),"LineString"===this.type){if("LineString"===e.type)return S(this.coordinates,e.coordinates);if("MultiLineString"===e.type)return P(this.coordinates,e.coordinates);if("Polygon"===e.type)return P(this.coordinates,E(e.coordinates));if("MultiPolygon"===e.type)return G(this.coordinates,e.coordinates)}else if("MultiLineString"===this.type){if("LineString"===e.type)return P(e.coordinates,this.coordinates);if("Polygon"===e.type||"MultiLineString"===e.type)return R(this.coordinates,e.coordinates);if("MultiPolygon"===e.type)return A(this.coordinates,e.coordinates)}else if("Polygon"===this.type){if("LineString"===e.type)return P(e.coordinates,E(this.coordinates));if("MultiLineString"===e.type)return R(E(this.coordinates),e.coordinates);if("Polygon"===e.type)return R(E(this.coordinates),E(e.coordinates));if("MultiPolygon"===e.type)return A(E(this.coordinates),e.coordinates)}else if("MultiPolygon"===this.type){if("LineString"===e.type)return G(e.coordinates,this.coordinates);if("Polygon"===e.type||"MultiLineString"===e.type)return A(E(e.coordinates),this.coordinates);if("MultiPolygon"===e.type)return k(this.coordinates,e.coordinates)}else if("Feature"===this.type){var r=new C(this.geometry);return r.intersects(e)}return t("Type "+this.type+" to "+e.type+" intersection is not supported by intersects"),!1},O.prototype=new C,O.prototype.constructor=O,q.prototype=new C,q.prototype.constructor=q,q.prototype.forEach=function(e){for(var t=0;this.length>t;t++)e.apply(this,[this.coordinates[t],t,this.coordinates]);return this},q.prototype.addPoint=function(e){return this.coordinates.push(e),this},q.prototype.insertPoint=function(e,t){return this.coordinates.splice(t,0,e),this},q.prototype.removePoint=function(e){return"number"==typeof e?this.coordinates.splice(e,1):this.coordinates.splice(this.coordinates.indexOf(e),1),this},q.prototype.get=function(e){return new O(this.coordinates[e])},I.prototype=new C,I.prototype.constructor=I,I.prototype.addVertex=function(e){return this.coordinates.push(e),this},I.prototype.insertVertex=function(e,t){return this.coordinates.splice(t,0,e),this},I.prototype.removeVertex=function(e){return this.coordinates.splice(e,1),this},U.prototype=new C,U.prototype.constructor=U,U.prototype.forEach=function(e){for(var t=0;this.coordinates.length>t;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},U.prototype.get=function(e){return new I(this.coordinates[e])},B.prototype=new C,B.prototype.constructor=B,B.prototype.addVertex=function(e){return this.coordinates[0].push(e),this},B.prototype.insertVertex=function(e,t){return this.coordinates[0].splice(t,0,e),this},B.prototype.removeVertex=function(e){return this.coordinates[0].splice(e,1),this},B.prototype.contains=function(e){if("Point"===e.type)return L(this.coordinates,e.coordinates);if("Polygon"===e.type){if(e.coordinates.length>0&&e.coordinates[0].length>0&&L(this.coordinates,e.coordinates[0][0])===!0&&this.intersects(e)===!1)return!0}else if("MultiPolygon"===e.type&&e.coordinates.length>0)for(var t=0;e.coordinates.length>t;t++)if(e.coordinates[t][0].length>0&&L(this.coordinates,e.coordinates[t][0][0])===!0&&this.intersects({type:"Polygon",coordinates:e.coordinates[t]})===!1)return!0;return!1},F.prototype=new C,F.prototype.constructor=F,F.prototype.forEach=function(e){for(var t=0;this.coordinates.length>t;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},F.prototype.contains=function(e){if("Point"!==e.type)throw Error("Only points are supported");for(var t=0;this.coordinates.length>t;t++)if(L(this.coordinates[t],e.coordinates))return!0;return!1},F.prototype.get=function(e){return new B(this.coordinates[e])},N.prototype=new C,N.prototype.constructor=N,N.prototype.contains=function(e){if("Point"!==e.type)throw Error("Only points are supported");if(!this.geometry.type.match(/Polygon/))throw Error("Only features containing Polygons and MultiPolygons are supported");if("MultiPolygon"===this.geometry.type)for(var t=0;this.geometry.coordinates.length>t;t++)if(L(this.geometry.coordinates[t],e.coordinates))return!0;return"Polygon"===this.geometry.type?L(this.geometry.coordinates,e.coordinates):!1},z.prototype=new C,z.prototype.constructor=z,z.prototype.forEach=function(e){for(var t=0;this.features.length>t;t++)e.apply(this,[this.features[t],t,this.features])},z.prototype.get=function(e){var t;return this.forEach(function(r){r.id===e&&(t=r)}),new N(t)},D.prototype=new C,D.prototype.constructor=D,D.prototype.forEach=function(e){for(var t=0;this.geometries.length>t;t++)e.apply(this,[this.geometries[t],t,this.geometries])},D.prototype.get=function(e){return new C(this.geometries[e])},Z.prototype=new C,Z.prototype.constructor=Z,Z.prototype.recalculate=function(){return this.geometry=H(this.center,this.radius,this.steps),this},Z.prototype.contains=function(e){if("Point"!==e.type)throw Error("Only points are supported");return L(this.geometry.coordinates,e.coordinates)},Z.prototype.toJSON=function(){var e=C.prototype.toJSON.call(this);return e.properties.center=e.center,e.properties.steps=e.steps,e.properties.radius=e.radius,delete e.center,delete e.steps,delete e.radius,e},J.Primitive=C,J.Point=O,J.MultiPoint=q,J.LineString=I,J.MultiLineString=U,J.Polygon=B,J.MultiPolygon=F,J.Feature=N,J.FeatureCollection=z,J.GeometryCollection=D,J.Circle=Z,J.toMercator=g,J.toGeographic=m,J.Tools={},J.Tools.positionToMercator=d,J.Tools.positionToGeographic=f,J.Tools.applyConverter=y,J.Tools.toMercator=g,J.Tools.toGeographic=m,J.Tools.createCircle=H,J.Tools.calculateBounds=n,J.Tools.calculateEnvelope=c,J.Tools.coordinatesContainPoint=M,J.Tools.polygonContainsPoint=L,J.Tools.arrayIntersectsArray=S,J.Tools.coordinatesContainPoint=M,J.Tools.convexHull=_,J.MercatorCRS=Q,J.GeographicCRS=K,J.Deferred=e,J}),function(e,t){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=t()),"function"==typeof define&&define.amd&&define(["terraformer/terraformer"],t),e.Terraformer===void 0&&(e.Terraformer={}),e.Terraformer.RTree=t().RTree}(this,function(){var Terraformer,e={};"object"==typeof this.navigator&&(Terraformer=this.Terraformer),"object"==typeof module&&"object"==typeof module.exports&&(Terraformer=require("terraformer")),arguments[0]&&"function"==typeof define&&define.amd&&(Terraformer=arguments[0]);var t=function(e){var r=3,n=6;isNaN(e)||(r=Math.floor(e/2),n=e),this.min_width=r,this.max_width=n;var o={x:0,y:0,w:0,h:0,id:"root",nodes:[]};(function(){var e={};return function(t){var r=0;return t in e?r=e[t]++:e[t]=0,t+"_"+r}})(),t.Rectangle.squarified_ratio=function(e,t,r){var n=(e+t)/2,o=e*t,i=o/(n*n);return o*r/i};var i=function(e,n,o){var i=[],s=[],a=[],u=1;if(!e||!t.Rectangle.overlap_rectangle(e,o))return a;var c={x:e.x,y:e.y,w:e.w,h:e.h,target:n};s.push(o.nodes.length),i.push(o);do{var l=i.pop(),f=s.pop()-1;if("target"in c)for(;f>=0;){var d=l.nodes[f];if(t.Rectangle.overlap_rectangle(c,d)){if(c.target&&"leaf"in d&&d.leaf===c.target||!c.target&&("leaf"in d||t.Rectangle.contains_rectangle(d,c))){"nodes"in d?(a=h(d,!0,[],d),l.nodes.splice(f,1)):a=l.nodes.splice(f,1),t.Rectangle.make_MBR(l.nodes,l),delete c.target,r>l.nodes.length&&(c.nodes=h(l,!0,[],l));break}"nodes"in d&&(u+=1,s.push(f),i.push(l),l=d,f=d.nodes.length)}f-=1}else if("nodes"in c){l.nodes.splice(f+1,1),l.nodes.length>0&&t.Rectangle.make_MBR(l.nodes,l);for(var y=0;c.nodes.length>y;y++)p(c.nodes[y],l);c.nodes.length=0,0===i.length&&1>=l.nodes.length?(c.nodes=h(l,!0,c.nodes,l),l.nodes.length=0,i.push(l),s.push(1)):i.length>0&&r>l.nodes.length?(c.nodes=h(l,!0,c.nodes,l),l.nodes.length=0):delete c.nodes}else t.Rectangle.make_MBR(l.nodes,l);u-=1}while(i.length>0);return a},s=function(e,r){var n,o=-1,i=[];i.push(r);var s=r.nodes;do{-1!==o&&(i.push(s[o]),s=s[o].nodes,o=-1);for(var a=s.length-1;a>=0;a--){var u=s[a];if("leaf"in u){o=-1;break}var c=t.Rectangle.squarified_ratio(u.w,u.h,u.nodes.length+1),l=Math.max(u.x+u.w,e.x+e.w)-Math.min(u.x,e.x),h=Math.max(u.y+u.h,e.y+e.h)-Math.min(u.y,e.y),p=t.Rectangle.squarified_ratio(l,h,u.nodes.length+2);(0>o||n>Math.abs(p-c))&&(n=Math.abs(p-c),o=a)}}while(-1!==o);return i},a=function(e){for(var t=c(e);e.length>0;)u(e,t[0],t[1]);return t},u=function(e,n,o){for(var i,s,a,u=t.Rectangle.squarified_ratio(n.w,n.h,n.nodes.length+1),c=t.Rectangle.squarified_ratio(o.w,o.h,o.nodes.length+1),l=e.length-1;l>=0;l--){var h=e[l],p={};p.x=Math.min(n.x,h.x),p.y=Math.min(n.y,h.y),p.w=Math.max(n.x+n.w,h.x+h.w)-p.x,p.h=Math.max(n.y+n.h,h.y+h.h)-p.y;var f=Math.abs(t.Rectangle.squarified_ratio(p.w,p.h,n.nodes.length+2)-u),d={};d.x=Math.min(o.x,h.x),d.y=Math.min(o.y,h.y),d.w=Math.max(o.x+o.w,h.x+h.w)-d.x,d.h=Math.max(o.y+o.h,h.y+h.h)-d.y;var y=Math.abs(t.Rectangle.squarified_ratio(d.w,d.h,o.nodes.length+2)-c);(!s||!i||i>Math.abs(y-f))&&(s=l,i=Math.abs(y-f),a=f>y?o:n)}var g=e.splice(s,1)[0];r>=n.nodes.length+e.length+1?(n.nodes.push(g),t.Rectangle.expand_rectangle(n,g)):r>=o.nodes.length+e.length+1?(o.nodes.push(g),t.Rectangle.expand_rectangle(o,g)):(a.nodes.push(g),t.Rectangle.expand_rectangle(a,g))},c=function(e){for(var t,r,n=e.length-1,o=0,i=e.length-1,s=0,a=e.length-2;a>=0;a--){var u=e[a];u.x>e[o].x?o=a:u.x+u.w<e[n].x+e[n].w&&(n=a),u.y>e[s].y?s=a:u.y+u.h<e[i].y+e[i].h&&(i=a)}var c=Math.abs(e[n].x+e[n].w-e[o].x),l=Math.abs(e[i].y+e[i].h-e[s].y);return c>l?n>o?(t=e.splice(n,1)[0],r=e.splice(o,1)[0]):(r=e.splice(o,1)[0],t=e.splice(n,1)[0]):i>s?(t=e.splice(i,1)[0],r=e.splice(s,1)[0]):(r=e.splice(s,1)[0],t=e.splice(i,1)[0]),[{x:t.x,y:t.y,w:t.w,h:t.h,nodes:[t]},{x:r.x,y:r.y,w:r.w,h:r.h,nodes:[r]}]},l=function(e,t){return e.nodes=t.nodes,e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e},h=function(e,r,n,o){var i=[];if(!t.Rectangle.overlap_rectangle(e,o))return n;i.push(o.nodes);do for(var s=i.pop(),a=s.length-1;a>=0;a--){var u=s[a];t.Rectangle.overlap_rectangle(e,u)&&("nodes"in u?i.push(u.nodes):"leaf"in u&&(r?n.push(u):n.push(u.leaf)))}while(i.length>0);return n},p=function(e,r){var o;if(0===r.nodes.length)return r.x=e.x,r.y=e.y,r.w=e.w,r.h=e.h,r.nodes.push(e),void 0;var i=s(e,r),u=e;do{if(o&&"nodes"in o&&0===o.nodes.length){var c=o;o=i.pop();for(var l=0;o.nodes.length>l;l++)if(o.nodes[l]===c||0===o.nodes[l].nodes.length){o.nodes.splice(l,1);break}}else o=i.pop();if("leaf"in u||"nodes"in u||Array.isArray(u)){if(Array.isArray(u)){for(var h=0;u.length>h;h++)t.Rectangle.expand_rectangle(o,u[h]);o.nodes=o.nodes.concat(u)}else t.Rectangle.expand_rectangle(o,u),o.nodes.push(u);if(n>=o.nodes.length)u={x:o.x,y:o.y,w:o.w,h:o.h};else{var p=a(o.nodes);u=p,1>i.length&&(o.nodes.push(p[0]),i.push(o),u=p[1])}}else t.Rectangle.expand_rectangle(o,u),u={x:o.x,y:o.y,w:o.w,h:o.h}}while(i.length>0)};this.serialize=function(e){var t=new Terraformer.Deferred;return e&&t.then(function(t){e(null,t)},function(t){e(t,null)}),t.resolve(o),t},this.deserialize=function(e,t,r){var n=Array.prototype.slice.call(arguments),i=new Terraformer.Deferred;switch(n.length){case 1:t=o;break;case 2:"function"==typeof n[1]&&(t=o,r=n[1])}return r&&i.then(function(e){r(null,e)},function(e){r(e,null)}),i.resolve(l(t,e)),i},this.search=function(e,t){var r;if(e.type){var n=Terraformer.Tools.calculateBounds(e);r={x:n[0],y:n[1],w:Math.abs(n[0]-n[2]),h:Math.abs(n[1]-n[3])}}else r=e;var i=new Terraformer.Deferred,s=[r,!1,[],o];if(void 0===r)throw"Wrong number of arguments. RT.Search requires at least a bounding rectangle.";return t&&i.then(function(e){t(null,e)},function(e){t(e,null)}),i.resolve(h.apply(this,s)),i},this.remove=function(e,t,r){var n=Array.prototype.slice.call(arguments),s=new Terraformer.Deferred;if(1===n.length&&n.push(!1),3===n.length&&(r=n.pop(),s.then(function(e){r(null,e)},function(e){r(e,null)})),n[0].type){var a=Terraformer.Tools.calculateBounds(e);n[0]={x:a[0],y:a[1],w:Math.abs(a[0]-a[2]),h:Math.abs(a[1]-a[3])}}if(n.push(o),t===!1){var u=0,c=[];do u=c.length,c=c.concat(i.apply(this,n));while(u!==c.length);return c}return i.apply(this,n)},this.insert=function(e,t,r){var n;if(e.type){var i=Terraformer.Tools.calculateBounds(e);n={x:i[0],y:i[1],w:Math.abs(i[0]-i[2]),h:Math.abs(i[1]-i[3])}}else n=e;var s=new Terraformer.Deferred;if(2>arguments.length)throw"Wrong number of arguments. RT.Insert requires at least a bounding rectangle or GeoJSON and an object.";return r&&s.then(function(e){r(null,e)},function(e){r(e,null)}),s.resolve(p({x:n.x,y:n.y,w:n.w,h:n.h,leaf:t},o)),s}};return t.Rectangle=function(e,t,r,n){var o,i,s,a,u,c;e.x?(o=e.x,s=e.y,0!==e.w&&!e.w&&e.x2?(u=e.x2-e.x,c=e.y2-e.y):(u=e.w,c=e.h),i=o+u,a=s+c):(o=e,s=t,u=r,c=n,i=o+u,a=s+c),this.x1=this.x=function(){return o},this.y1=this.y=function(){return s},this.x2=function(){return i},this.y2=function(){return a},this.w=function(){return u},this.h=function(){return c},this.toJSON=function(){return'{"x":'+(""+o)+', "y":'+(""+s)+', "w":'+(""+u)+', "h":'+(""+c)+"}"},this.overlap=function(e){return this.x()<e.x2()&&this.x2()>e.x()&&this.y()<e.y2()&&this.y2()>e.y()},this.expand=function(e){var t=Math.min(this.x(),e.x()),r=Math.min(this.y(),e.y());return u=Math.max(this.x2(),e.x2())-t,c=Math.max(this.y2(),e.y2())-r,o=t,s=r,this},this.setRect=function(e,t,r,n){var o,i,s,a,u,c;e.x?(o=e.x,s=e.y,0!==e.w&&!e.w&&e.x2?(u=e.x2-e.x,c=e.y2-e.y):(u=e.w,c=e.h),i=o+u,a=s+c):(o=e,s=t,u=r,c=n,i=o+u,a=s+c)}},t.Rectangle.overlap_rectangle=function(e,t){return e.x<t.x+t.w&&e.x+e.w>t.x&&e.y<t.y+t.h&&e.y+e.h>t.y},t.Rectangle.contains_rectangle=function(e,t){return e.x+e.w<=t.x+t.w&&e.x>=t.x&&e.y+e.h<=t.y+t.h&&e.y>=t.y},t.Rectangle.expand_rectangle=function(e,t){var r,n;return r=e.x<t.x?e.x:t.x,n=e.y<t.y?e.y:t.y,e.w=e.x+e.w>t.x+t.w?e.x+e.w-r:t.x+t.w-r,e.h=e.y+e.h>t.y+t.h?e.y+e.h-n:t.y+t.h-n,e.x=r,e.y=n,e},t.Rectangle.make_MBR=function(e,r){if(1>e.length)return{x:0,y:0,w:0,h:0};r?(r.x=e[0].x,r.y=e[0].y,r.w=e[0].w,r.h=e[0].h):r={x:e[0].x,y:e[0].y,w:e[0].w,h:e[0].h};for(var n=e.length-1;n>0;n--)t.Rectangle.expand_rectangle(r,e[n]);return r},e.RTree=t,e}),function(e,t){"object"==typeof module&&"object"==typeof module.exports&&(exports=module.exports=t()),"function"==typeof define&&define.amd&&define(["terraformer/terraformer"],t),"object"==typeof e.navigator&&(e.Terraformer===void 0&&(e.Terraformer={}),e.Terraformer.ArcGIS=t())}(this,function(){function e(e){for(var t,r=[],n=0;e.length>n;n++){t=e[n];for(var o=0;t.length>o;o++)r.push(t[o])}return r}function t(e,t){var r=Terraformer.Tools.arrayIntersectsArray(e,t),n=Terraformer.Tools.coordinatesContainPoint(e,t[0]);return!r&&n?!0:!1}function r(e){for(var r,n,o=[],i=0;e.length>i;i++){r=e[i];var s=[r],a=!1;for(n=0;e.length>n;n++){var u=e[n];r!==u&&t(u,r)&&(a=!0)}if(!a){for(n=0;e.length>n;n++){var c=e[n];r!==e[n]&&t(r,c)&&s.push(e[n])}o.push(s)}}return{type:"MultiPolygon",coordinates:o}}function n(e){var t={};e.x&&e.y&&(t.type="Point",t.coordinates=[e.x,e.y]),e.points&&(t.type="MultiPoint",t.coordinates=e.points),e.paths&&(1===e.paths.length?(t.type="LineString",t.coordinates=e.paths[0]):(t.type="MultiLineString",t.coordinates=e.paths)),e.rings&&(t=r(e.rings)),e.attributes&&e.geometry&&(t.type="Feature",t.geometry=n(e.geometry),t.properties=e.attributes);var o=e.geometry?e.geometry.spatialReference:e.spatialReference;return o&&102100===o.wkid&&(t=Terraformer.toGeographic(t)),new Terraformer.Primitive(t)}function o(t,r){var n,i=r?r:{wkid:4326},s={};switch(t.type){case"Point":s.x=t.coordinates[0],s.y=t.coordinates[1],s.spatialReference=i;break;case"MultiPoint":s.points=t.coordinates,s.spatialReference=i;break;case"LineString":s.paths=[t.coordinates],s.spatialReference=i;break;case"MultiLineString":s.paths=t.coordinates,s.spatialReference=i;break;case"Polygon":s.rings=t.coordinates,s.spatialReference=i;break;case"MultiPolygon":s.rings=e(t.coordinates),s.spatialReference=i;break;case"Feature":s.geometry=o(t.geometry),s.attributes=t.properties;break;case"FeatureCollection":for(s=[],n=0;t.features.length>n;n++)s.push(o(t.features[n]));break;case"GeometryCollection":for(s=[],n=0;t.geometries.length>n;n++)s.push(o(t.geometries[n]))}return s}var Terraformer,i={};return"object"==typeof this.navigator&&(Terraformer=this.Terraformer),"object"==typeof module&&"object"==typeof module.exports&&(Terraformer=require("terraformer")),arguments[0]&&"function"==typeof define&&define.amd&&(Terraformer=arguments[0]),i.parse=n,i.convert=o,i}),L.esri===void 0&&(L.esri={}),L.esri.Util={extentToBounds:function(e){var t=new L.LatLng(e.xmin,e.ymin),r=new L.LatLng(e.xmax,e.ymin);return new L.LatLngBounds(t,r)},boundsToExtent:function(e){return{xmin:e.getSouthWest().lng,ymin:e.getSouthWest().lat,xmax:e.getNorthEast().lng,ymax:e.getNorthEast().lat,spatialReference:{wkid:4326}}},boundsToEnvelope:function(e){var t=L.esri.Util.boundsToExtent(e);return{x:t.xmin,y:t.ymin,w:Math.abs(t.xmin-t.ymax),h:Math.abs(t.ymin-t.ymax)}}},L.esri.FeatureLayer=L.GeoJSON.extend({initialize:function(e,t){this.index=new Terraformer.RTree,this._serviceUrl=e,this._layerCache={},this.client=new Esri.ArcGIS,this.service=new this.client.FeatureService({url:e}),L.GeoJSON.prototype.initialize.call(this,[],t)
},onAdd:function(e){L.LayerGroup.prototype.onAdd.call(this,e),this.updateFeatures(e)},onRemove:function(e){this.eachLayer(e.removeLayer,e),e.off("viewreset moveend",L.Util.bind(this.updateFeatures,this))},updateFeatures:function(e){var t=L.Util.bind(function(){var t=e.getBounds(),r=L.esri.Util.boundsToEnvelope(t);this.index.search(r).then(L.Util.bind(function(t){this.eachLayer(L.Util.bind(function(r){var n=r.feature.id;-1===t.indexOf(n)?(this._layerCache[n]=this._layers[n],e.removeLayer(this._layers[n])):this._layerCache[n]&&this._layerCache[n].addTo(e)},this))},this)),this.service.query({geometryType:"esriGeometryEnvelope",geometry:JSON.stringify(L.esri.Util.boundsToExtent(t)),outSr:4326},L.Util.bind(function(e,t){for(var r=t.objectIdFieldName,n=t.features.length-1;n>=0;n--){var o=t.features[n],i=o.attributes[r];if(!this._layers[i]){var s=Terraformer.ArcGIS.parse(o);s.id=i,this.index.insert(s,i),this.addData(s)}}},this))},this),r=L.Util.bind(function(){clearTimeout(this._delay),this._delay=setTimeout(L.Util.bind(function(){t()},this),150)},this);e.on("viewreset moveend",r),t()},getLayerId:function(e){return e.feature.id}}),L.esri.featureLayer=function(e,t){return new L.esri.FeatureLayer(e,t)},L.esri===void 0&&(L.esri={}),L.esri.TileLayer=L.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attributionUrl:"http://static.arcgis.com/attribution/World_Street_Map?f=json",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Esri</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},Topographic:{urlTemplate:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attributionUrl:"http://static.arcgis.com/attribution/World_Topo_Map?f=json",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Esri</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},Oceans:{urlTemplate:"http://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}",attributionUrl:"http://static.arcgis.com/attribution/Ocean_Basemap?f=json",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Esri</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},NationalGeographic:{urlTemplate:"http://server.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Esri</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},Gray:{urlTemplate:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Copyright: &copy;2013 Esri, DeLorme, NAVTEQ</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},GrayLabels:{urlTemplate:"http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19}},Imagery:{urlTemplate:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"<span class='esri-attributions'>Esri, DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community</span><img src='http://serverapi.arcgisonline.com/jsapi/arcgis/3.4/js/esri/images/map/logo-med.png' alt='Powered by Esri' class='esri-attribution-logo'>"}},ImageryLabels:{urlTemplate:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19}}}},initialize:function(e,t){var r;if("object"==typeof e&&e.urlTemplate&&e.options)r=e;else{if("string"!=typeof e||!L.esri.TileLayer.TILES[e])throw Error("L.esri.TileLayer: Invalid parameter. Use one of 'Streets', 'Topographic', 'Oceans', 'NationalGeographic', 'Gray', 'GrayLabels', 'Imagery' or 'ImageryLabels'");r=L.esri.TileLayer.TILES[e]}var n=L.Util.extend(r.options,t);L.TileLayer.prototype.initialize.call(this,r.urlTemplate,L.Util.setOptions(this,n)),r.attributionUrl&&(this.dynamicAttribution=!0,this.getAttributionData(r.attributionUrl))},dynamicAttribution:!1,bounds:null,zoom:null,handleTileUpdates:function(e){var t,r;"load"===e.type&&(t=this._map.getBounds(),r=this._map.getZoom()),("viewreset"===e.type||"dragend"===e.type||"zoomend"===e.type)&&(t=e.target.getBounds(),r=e.target.getZoom()),this.attributionBoundingBoxes&&t&&r&&(t.equals(this.bounds)&&r===this.zoom||(this.bounds=t,this.zoom=r,this.updateMapAttribution()))},onAdd:function(e){L.TileLayer.prototype.onAdd.call(this,e),this.dynamicAttribution&&(this.on("load",this.handleTileUpdates),this._map.on("viewreset zoomend dragend",this.handleTileUpdates))},onRemove:function(e){this.dynamicAttribution&&(this.off("load",this.handleTileUpdates),this._map.off("viewreset zoomend dragend",this.handleTileUpdates)),L.TileLayer.prototype.onRemove.call(this,e)},getAttributionData:function(e){this.attributionBoundingBoxes=[];var t;window.XMLHttpRequest?t=new XMLHttpRequest:window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=L.bind(this.processAttributionData,this),t.open("GET",e,!0),t.send(null)},processAttributionData:function(e){if(4===e.target.readyState&&200===e.target.status){for(var t=JSON.parse(e.target.responseText),r=0;t.contributors.length>r;r++)for(var n=t.contributors[r],o=0;n.coverageAreas.length>o;o++){var i=n.coverageAreas[o],s=new L.LatLng(i.bbox[0],i.bbox[1]),a=new L.LatLng(i.bbox[2],i.bbox[3]);this.attributionBoundingBoxes.push({attribution:n.attribution,score:i.score,bounds:new L.LatLngBounds(s,a),minZoom:i.zoomMin,maxZoom:i.zoomMax})}this.attributionBoundingBoxes.sort(function(e,t){return e.score<t.score?-1:e.score>t.score?1:0}),this.bounds&&this.updateMapAttribution()}},updateMapAttribution:function(){for(var e=[],t=0;this.attributionBoundingBoxes.length>t;t++){var r=this.attributionBoundingBoxes[t];if(this.bounds.intersects(r.bounds)&&this.zoom>=r.minZoom&&this.zoom<=r.maxZoom){var n=this.attributionBoundingBoxes[t].attribution;-1===e.indexOf(n)&&e.push(n)}}this._map._container.getElementsByClassName("esri-attributions")[0].innerHTML=e.join(", ")}}),L.esri.tileLayer=function(e,t){return new L.esri.TileLayer(e,t)};