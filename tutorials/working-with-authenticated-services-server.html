<!DOCTYPE html>
<!--[if lt IE 7 ]> <html class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="not-ie"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  
    <title>Working with Authenticated Services in ArcGIS Server | Esri Leaflet</title>
  

  
    <meta name="description" content="How to access secure ArcGIS Enterprise services in Esri Leaflet.">
  

  
    <meta http-equiv="refresh" content="0;URL='https://developers.arcgis.com/esri-leaflet/authentication/apikeys/'" />
  

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--[if lt IE 9]>
    <script src="//cdn.jsdelivr.net/html5shiv/3.7.2/html5shiv-printshiv.js"></script>
  <![endif]-->

  <!-- google fonts -->
  <link href="//fonts.googleapis.com/css?family=Vollkorn:400italic,700italic,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Source+Code+Pro:300">
  <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <!-- stylesheet -->
  <link rel="stylesheet" href="../css/style.css">

  

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

  
    <script src="https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"
      integrity="sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="
      crossorigin=""></script>
  

  

  

  

  
</head>
<body>
  <div class="page-content ">
    <div class="container">
      <span id="mobileMenuButton" class="mobileMenuButton">&#9776;</span>
      <a class="site-nav" href="../" class="left logo">Esri Leaflet</a>
      <nav id="site-nav-wrapper" class="site-nav-wrapper">
        <a class="site-nav" href="../tutorials/">Tutorials</a>
        <a class="site-nav" href="../examples/">Examples</a>
        <a class="site-nav" href="../api-reference/">API Reference</a>
        <a class="site-nav" href="../plugins/">Plugins</a>
        <a class="site-nav" href="../download/">Download</a>
        <a class="site-nav" href="https://github.com/Esri/esri-leaflet">View on GitHub</a>
      </nav>
    </div>
    <div id="background-map" class="background-map"></div>
    <div class="container alertArea">This content has moved to <a href="https://developers.arcgis.com/esri-leaflet/">developers.arcgis.com</a>. Please update your bookmarks!</div>

  

<div class="container white">
  

<aside class="sidebar">
  <h5>General</h5>
  <nav>
    <a href="../tutorials/display-a-map.html">Display a map</a>
    <a href="../tutorials/introduction-to-layer-types.html">Introduction to Layer Types</a>
    <a href="../tutorials/javascript-libraries.html">JavaScript Libraries</a>
    <a href="../tutorials/working-with-authenticated-services-server.html">Working with Authenticated Services</a>
    <a href="https://developers.arcgis.com/esri-leaflet/maps/change-the-basemap-layer/">Change the basemap layer</a>
  </nav>
  <h5>Layers</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-vector-tile-layer/">Add a vector tile layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-feature-layer-as-geojson/">Add a feature layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-raster-tile-layer/">Add a raster tile layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/display-a-popup/">Display a pop-up</a>
  </nav>
  <h5>Query</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/query-and-edit/query-a-feature-layer-sql/">Query a feature layer (SQL)</a>
    <a href="https://developers.arcgis.com/esri-leaflet/query-and-edit/query-a-feature-layer-spatial/">Query a feature layer (spatial)</a>
  </nav>
  <h5>Visualization</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/styles-and-visualization/style-a-feature-layer/">Style a feature layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/styles-and-visualization/display-a-custom-vector-tile-style/">Display a custom vector tile style</a>
  </nav>
  <h5>Search</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/search-for-an-address/">Search for an address</a>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/reverse-geocode/">Reverse geocode</a>
  </nav>
  <h5>Routing</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/find-places/">Find places</a>
    <a href="https://developers.arcgis.com/esri-leaflet/route-and-directions/find-a-route-and-directions/">Find a route and directions</a>
    <a href="https://developers.arcgis.com/esri-leaflet/route-and-directions/find-service-areas/">Find service areas</a>
  </nav>
  <h5>Demographics</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/demographic-data/query-demographic-data/">Query demographic data</a>
  </nav>
</aside>


<div class="main-content">
  <h1 id="working-with-authenticated-services-in-arcgis-server">Working with Authenticated Services in ArcGIS Server</h1>
<p>How to access secure ArcGIS Enterprise services in Esri Leaflet.</p>
<h4 id="introduction">Introduction</h4>
<p>In this tutorial, you will learn how to display authenticated services from ArcGIS Server in Leaflet.</p>
<p>Authenticated services published on ArcGIS Server require a username and password to be accessed. During the authentication process, credentials are exchanged for a token.  To add one of these secure services in Leaflet, we&#39;ll use <code>L.esri.post</code> to ask the server to generate a token. You can find an example of the raw <code>generateToken</code> REST operation we&#39;ll be calling <a href="https://sampleserver6.arcgisonline.com/arcgis/tokens/">here</a>.  You can learn more about making generic requests with Esri Leaflet by visiting the <a href="esri-leaflet/api-reference/request.html">documentation site</a>.</p>
<p>Here is an outline of the process:</p>
<ol>
<li>Create an empty <code>html</code> file and add the Leaflet and Esri Leaflet libraries via CDN</li>
<li>Create DOM nodes for the map, and the form that will execute a function to request a token.</li>
<li>Create a function that will be tied to the click event of the submit button of the form. This will call the function created in the previous step.</li>
</ol>
<h4 id="create-an-html-file-and-reference-leaflet-and-esri-leaflet-via-cdn">Create an <code>html</code> file and reference Leaflet and Esri Leaflet Via CDN</h4>
<pre><code class="language-xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Esri Leaflet Authenticated Services<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"</span>&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN--&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>/&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>
<h4 id="add-elements-for-the-map-container-and-form">Add Elements for the Map Container and Form</h4>
<p>Next we&#39;ll need to create a <code>&lt;div&gt;</code> to hold our map and nest a <code>&lt;form&gt;</code> element inside.</p>
<p>Within the <code>&lt;form&gt;</code>, we&#39;ll add text inputs and labels to capture the username and password. We&#39;ll also create a submit button that will execute a function to submit the service credentials, and then add a layer to the map.</p>
<pre><code class="language-xml"><span class="tag">&lt;<span class="title">form</span> <span class="attribute">id</span>=<span class="value">"securedServicesForm"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"username"</span>&gt;</span>User Name<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
    <span class="comment">&lt;!-- this will be the username for the service --&gt;</span>
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"username"</span> /&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"password"</span>&gt;</span>Password<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
    <span class="comment">&lt;!-- this will be the password for the service --&gt;</span>
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">id</span>=<span class="value">"password"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="comment">&lt;!-- a click event handler will be placed on this element to run our function --&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">id</span>=<span class="value">"formSubmit"</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Add Service<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span></code></pre>
<blockquote>
<p>For most instances of ArcGIS Server, the generate token URL will be <strong>[server domain]/arcgis/tokens/GenerateToken</strong>.  However, depending upon the installation of ArcGIS Server, the URL may be different.</p>
</blockquote>
<p>We&#39;ll need to define a few rules to control the style of the elements we have created.  Using a .css framework may make this process easier. <a href="https://github.com/Esri/calcite-maps">Esri Calcite Maps</a> uses Bootstrap and contains samples for Esri Leaflet.  Below is how the form looks on the map.</p>
<p><img src="/esri-leaflet/img/tutorials/ags-secured-services/secured-service-form-screenshot.png" alt="screen shot of form to add secured service to map" title="Form to add secured services to map"></p>
<pre><code class="language-xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Esri Leaflet Authenticated Services<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"</span>&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN--&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>/&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
    <span class="tag">html</span>,
    <span class="tag">body</span>,
    <span class="id">#map</span> <span class="rules">{
      <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100</span>%</span></span>;
      <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100</span>%</span></span>;
      <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;
      <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;
    <span class="rule">}</span></span>

    <span class="class">.form-container</span> <span class="rules">{
      <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;
      <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">15</span>px</span></span>;
      <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">15</span>px</span></span>;
      <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">25</span>px</span></span>;
      <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">2</span>px solid <span class="hexcolor">#333</span></span></span>;
      <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;
      <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">1.15</span>em</span></span>;
      <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">1000</span></span></span>;
    <span class="rule">}</span></span>

    <span class="class">.form-component</span> <span class="rules">{
      <span class="rule"><span class="attribute">margin-bottom</span>:<span class="value"> <span class="number">15</span>px</span></span>;
    <span class="rule">}</span></span>
  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
  <span class="comment">&lt;!-- container for map --&gt;</span>
  <span class="tag">&lt;<span class="title">section</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span>
    <span class="comment">&lt;!-- form to add in secured service --&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-container"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">form</span> <span class="attribute">id</span>=<span class="value">"securedServicesForm"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
          <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"username"</span>&gt;</span>User Name<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
          <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"username"</span> /&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
          <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"password"</span>&gt;</span>Password<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
          <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">id</span>=<span class="value">"password"</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">button</span> <span class="attribute">id</span>=<span class="value">"formSubmit"</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Add Services<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
      <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">section</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>
<h4 id="write-javascript-for-map-object-and-function-to-add-service-to-map">Write JavaScript for Map Object and Function to Add Service to Map</h4>
<p>Next we&#39;ll create a <code>&lt;script&gt;</code> tag and start writing JavaScript to create a map object and choose a basemap:</p>
<pre><code class="language-js"><span class="comment">// create map and set zoom level and center coordinates</span>
<span class="keyword">const</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">34.089</span>, -<span class="number">116.865</span>], <span class="number">9</span>);

<span class="comment">// set basemap to Esri Streets</span>
L.esri.basemapLayer(<span class="string">'Streets'</span>).addTo(map);</code></pre>
<p>Then we will create a function that executes when the <strong>submit</strong> button of the form is clicked.</p>
<pre><code class="language-js"><span class="comment">// function to run when form is submitted</span>
<span class="function"><span class="keyword">function</span> <span class="title">addServicesFromServer</span> <span class="params">()</span> {</span>}

<span class="comment">// submit element of form</span>
<span class="keyword">const</span> submitBtn = document.getElementById(<span class="string">'formSubmit'</span>);

<span class="comment">// add event listener to form</span>
submitBtn.addEventListener(<span class="string">'click'</span>, addServicesFromServer);</code></pre>
<p>Our function <strong>addServicesFromServer</strong> will need to get the values from the text inputs, make a POST request to the ArcGIS Server to generate the token. Afterward we can add the layer to the map.</p>
<pre><code class="language-js"><span class="function"><span class="keyword">function</span> <span class="title">addServicesFromServer</span> <span class="params">(e)</span> {</span>
  <span class="comment">// prevent page from refreshing when the form is submitted</span>
  e.preventDefault();

  <span class="comment">// get values from form</span>
  <span class="keyword">const</span> username = document.getElementById(<span class="string">'username'</span>).value;
  <span class="keyword">const</span> password = document.getElementById(<span class="string">'password'</span>).value;

  <span class="comment">// call function to handle server request</span>
}</code></pre>
<p>We will need to make a POST request to ArcGIS Server. <code>L.esri.post()</code> requires the request URL, the parameters to send as the query string and a callback function that runs when the request completes.</p>
<pre><code class="language-js"><span class="function"><span class="keyword">function</span> <span class="title">serverAuth</span> <span class="params">(server, username, password, callback)</span> {</span>
  L.esri.post(server, {
    username: username,
    password: password,
    f: <span class="string">'json'</span>,
    expiration: <span class="number">86400</span>,
    client: <span class="string">'referer'</span>,
    referer: window.location.origin
  }, callback);
}</code></pre>
<p>Here is what our <code>&lt;script&gt;</code> tag looks like now.</p>
<pre><code class="language-js"><span class="string">'use strict'</span>;

<span class="comment">// submit element of form</span>
<span class="keyword">const</span> submitBtn = document.getElementById(<span class="string">'formSubmit'</span>);

<span class="comment">// add event listener to form</span>
submitBtn.addEventListener(<span class="string">'click'</span>, addServicesFromServer);

<span class="comment">// create map and set zoom level and center coordinates</span>
<span class="keyword">const</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">34.089</span>, -<span class="number">116.865</span>], <span class="number">9</span>);

<span class="comment">// set basemap to Esri Streets</span>
L.esri.basemapLayer(<span class="string">'Streets'</span>).addTo(map);

<span class="keyword">const</span> tokenUrl = <span class="string">'https://sampleserver6.arcgisonline.com/arcgis/tokens/generateToken'</span>;

<span class="comment">// function to make request to server</span>
<span class="function"><span class="keyword">function</span> <span class="title">serverAuth</span> <span class="params">(server, username, password, callback)</span> {</span>
  L.esri.post(server, {
    username: username,
    password: password,
    f: <span class="string">'json'</span>,
    expiration: <span class="number">86400</span>,
    client: <span class="string">'referer'</span>,
    referer: window.location.origin
  }, callback);
}

<span class="comment">// function to run when form submitted</span>
<span class="function"><span class="keyword">function</span> <span class="title">addServicesFromServer</span> <span class="params">(e)</span> {</span>
  <span class="comment">// prevent page from refreshing</span>
  e.preventDefault();

  <span class="comment">// get values from form</span>
  <span class="keyword">const</span> username = document.getElementById(<span class="string">'username'</span>).value;
  <span class="keyword">const</span> password = document.getElementById(<span class="string">'password'</span>).value;

  <span class="comment">// generate token from server and add service from callback function</span>
  serverAuth(tokenUrl, username, password, <span class="function"><span class="keyword">function</span> <span class="params">(error, response)</span> {</span>
    <span class="keyword">if</span> (error) {
      <span class="keyword">return</span>;
    }
    <span class="comment">// add layer to map</span>
    L.esri.dynamicMapLayer({
      url: <span class="string">'https://sampleserver6.arcgisonline.com/arcgis/rest/services/Wildfire_secure_ac/MaServer'</span>,
      opacity: <span class="number">1</span>,
      token: response.token
    }).addTo(map);
  }); <span class="comment">// end serverAuth call</span>
} <span class="comment">// end addServicesFromServer call</span></code></pre>
<p>Our response from the token generation page includes our access token for the service.  We pass this into the token option for the map service.  The username and password for this service are <strong>user1</strong>.</p>
<p><img src="/esri-leaflet/img/tutorials/ags-secured-services/secured-services-on-map.png" alt="screen shot of map with secured services" title="Map with secured services displayed"></p>
<p>We have now built a basic Esri Leaflet web map that retrieves an authenticated service from ArcGIS Server.</p>
<pre><code class="language-xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Esri Leaflet Authenticated Services<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"</span>&gt;</span>

  <span class="comment">&lt;!-- Load Leaflet from CDN--&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">"stylesheet"</span> <span class="attribute">href</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>/&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="comment">&lt;!-- Load Esri Leaflet from CDN --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"https://unpkg.com/esri-leaflet@3.0.8/dist/esri-leaflet.js"</span>
  <span class="attribute">integrity</span>=<span class="value">"sha512-E0DKVahIg0p1UHR2Kf9NX7x7TUewJb30mxkxEm2qOYTVJObgsAGpEol9F6iK6oefCbkJiA4/i6fnTHzM6H1kEA=="</span>
  <span class="attribute">crossorigin</span>=<span class="value">""</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">
    <span class="tag">html</span>,
    <span class="tag">body</span>,
    <span class="id">#map</span> <span class="rules">{
      <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100</span>%</span></span>;
      <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100</span>%</span></span>;
      <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span></span></span>;
      <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span></span></span>;
    <span class="rule">}</span></span>

    <span class="class">.form-container</span> <span class="rules">{
      <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;
      <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">15</span>px</span></span>;
      <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">15</span>px</span></span>;
      <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">25</span>px</span></span>;
      <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">2</span>px solid <span class="hexcolor">#333</span></span></span>;
      <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;
      <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">1.15</span>em</span></span>;
      <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">1000</span></span></span>;
    <span class="rule">}</span></span>

    <span class="class">.form-component</span> <span class="rules">{
      <span class="rule"><span class="attribute">margin-bottom</span>:<span class="value"> <span class="number">15</span>px</span></span>;
    <span class="rule">}</span></span>
  </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
  <span class="comment">&lt;!-- container for map --&gt;</span>
  <span class="tag">&lt;<span class="title">section</span> <span class="attribute">id</span>=<span class="value">"map"</span>&gt;</span>
    <span class="comment">&lt;!-- form to add in secured service --&gt;</span>
    <span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span>=<span class="value">"form-container"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">form</span> <span class="attribute">id</span>=<span class="value">"securedServicesForm"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
          <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"username"</span>&gt;</span>User Name<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
          <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">id</span>=<span class="value">"username"</span> /&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"form-component"</span>&gt;</span>
          <span class="tag">&lt;<span class="title">label</span> <span class="attribute">for</span>=<span class="value">"password"</span>&gt;</span>Password<span class="tag">&lt;/<span class="title">label</span>&gt;</span>
          <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">id</span>=<span class="value">"password"</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
        <span class="tag">&lt;<span class="title">button</span> <span class="attribute">id</span>=<span class="value">"formSubmit"</span> <span class="attribute">type</span>=<span class="value">"submit"</span>&gt;</span>Add Services<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
      <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">section</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">section</span>&gt;</span>

  <span class="comment">&lt;!-- script to create map and load secured services --&gt;</span>
  <span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
    <span class="string">'use strict'</span>;

    <span class="comment">// submit element of form</span>
    <span class="keyword">const</span> submitBtn = document.getElementById(<span class="string">'formSubmit'</span>);

    <span class="comment">// add event listener to form</span>
    submitBtn.addEventListener(<span class="string">'click'</span>, addServicesFromServer);

    <span class="comment">// create map and set zoom level and center coordinates</span>
    <span class="keyword">const</span> map = L.map(<span class="string">'map'</span>).setView([<span class="number">34.089</span>, -<span class="number">116.865</span>], <span class="number">9</span>);

    <span class="comment">// set basemap to Esri Streets</span>
    L.esri.basemapLayer(<span class="string">'Streets'</span>).addTo(map);

    <span class="keyword">const</span> tokenUrl = <span class="string">'https://sampleserver6.arcgisonline.com/arcgis/tokens/generateToken'</span>;

    <span class="comment">// function to make request to server</span>
    <span class="function"><span class="keyword">function</span> <span class="title">serverAuth</span> <span class="params">(server, username, password, callback)</span> {</span>
      L.esri.post(server, {
        username: username,
        password: password,
        f: <span class="string">'json'</span>,
        expiration: <span class="number">86400</span>,
        client: <span class="string">'referer'</span>,
        referer: window.location.origin
      }, callback);
    }

    <span class="comment">// function to run when form submitted</span>
    <span class="function"><span class="keyword">function</span> <span class="title">addServicesFromServer</span> <span class="params">(e)</span> {</span>
      <span class="comment">// prevent page from refreshing</span>
      e.preventDefault();

      <span class="comment">// get values from form</span>
      <span class="keyword">const</span> username = document.getElementById(<span class="string">'username'</span>).value;
      <span class="keyword">const</span> password = document.getElementById(<span class="string">'password'</span>).value;

      <span class="comment">// generate token from server and add service from callback function</span>
      serverAuth(tokenUrl, username, password, <span class="function"><span class="keyword">function</span> <span class="params">(error, response)</span> {</span>
        <span class="keyword">if</span> (error) {
          <span class="keyword">return</span>;
        }
        <span class="comment">// add layer to map</span>
        L.esri.dynamicMapLayer({
          url: <span class="string">'https://sampleserver6.arcgisonline.com/arcgis/rest/services/Wildfire_secure_ac/MapServer'</span>,
          opacity: <span class="number">1</span>,
          token: response.token
        }).addTo(map);
      }); <span class="comment">// end serverAuth call</span>
    } <span class="comment">// end addServicesFromServer call</span>
  </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>

  <p><a href="https://github.com/esri/esri-leaflet-doc/edit/master/src/pages/tutorials/working-with-authenticated-services-server.md">Edit this page on GitHub</a></p>

  <div class="mobile-menu">
    <aside class="sidebar">
  <h5>General</h5>
  <nav>
    <a href="../tutorials/display-a-map.html">Display a map</a>
    <a href="../tutorials/introduction-to-layer-types.html">Introduction to Layer Types</a>
    <a href="../tutorials/javascript-libraries.html">JavaScript Libraries</a>
    <a href="../tutorials/working-with-authenticated-services-server.html">Working with Authenticated Services</a>
    <a href="https://developers.arcgis.com/esri-leaflet/maps/change-the-basemap-layer/">Change the basemap layer</a>
  </nav>
  <h5>Layers</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-vector-tile-layer/">Add a vector tile layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-feature-layer-as-geojson/">Add a feature layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/add-a-raster-tile-layer/">Add a raster tile layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/layers/display-a-popup/">Display a pop-up</a>
  </nav>
  <h5>Query</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/query-and-edit/query-a-feature-layer-sql/">Query a feature layer (SQL)</a>
    <a href="https://developers.arcgis.com/esri-leaflet/query-and-edit/query-a-feature-layer-spatial/">Query a feature layer (spatial)</a>
  </nav>
  <h5>Visualization</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/styles-and-visualization/style-a-feature-layer/">Style a feature layer</a>
    <a href="https://developers.arcgis.com/esri-leaflet/styles-and-visualization/display-a-custom-vector-tile-style/">Display a custom vector tile style</a>
  </nav>
  <h5>Search</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/search-for-an-address/">Search for an address</a>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/reverse-geocode/">Reverse geocode</a>
  </nav>
  <h5>Routing</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/geocode-and-search/find-places/">Find places</a>
    <a href="https://developers.arcgis.com/esri-leaflet/route-and-directions/find-a-route-and-directions/">Find a route and directions</a>
    <a href="https://developers.arcgis.com/esri-leaflet/route-and-directions/find-service-areas/">Find service areas</a>
  </nav>
  <h5>Demographics</h5>
  <nav>
    <a href="https://developers.arcgis.com/esri-leaflet/demographic-data/query-demographic-data/">Query demographic data</a>
  </nav>
</aside>

  </div>
</div>

  <div style="clear:both;"></div>
</div>

  <div class="container center-text">
    <p class="copyright"><a href="https://github.com/esri/esri-leaflet#terms">Terms</a></p>
  </div>
  <script src="../js/script.js"></script>
  </body>
</html>